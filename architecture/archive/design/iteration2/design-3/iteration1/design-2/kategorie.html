<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Micro-Interaction Rich - Obst &amp; Gem&uuml;se</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #121216;
    --surface: rgba(255,255,255,0.04);
    --teal: #4E9DA6;
    --teal-glow: 0 0 15px rgba(78,157,166,0.4), 0 0 30px rgba(78,157,166,0.15);
    --orange: #E8923A;
    --orange-glow: 0 0 12px rgba(232,146,58,0.5);
    --green: #6BBF6B;
    --text-primary: #ffffff;
    --text-secondary: rgba(255,255,255,0.5);
    --text-dim: rgba(255,255,255,0.35);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    background: #0a0a0e;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: 'Plus Jakarta Sans', sans-serif;
    color: var(--text-primary);
  }

  .phone-frame {
    width: 390px;
    height: 844px;
    background: var(--bg);
    border-radius: 44px;
    overflow: hidden;
    position: relative;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 0 60px rgba(0,0,0,0.5), 0 0 120px rgba(78,157,166,0.05);
  }

  .screen {
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    padding-bottom: 110px;
    scrollbar-width: none;
  }

  .screen::-webkit-scrollbar {
    display: none;
  }

  /* Status Bar */
  .status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 28px 8px;
    position: sticky;
    top: 0;
    z-index: 50;
    background: var(--bg);
  }

  .status-time {
    font-size: 15px;
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .status-icons {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .status-icons svg {
    width: 16px;
    height: 16px;
    fill: white;
  }

  /* Header */
  .header {
    display: flex;
    align-items: center;
    padding: 8px 20px 4px;
    gap: 14px;
  }

  .back-btn {
    width: 40px;
    height: 40px;
    border-radius: 14px;
    border: 1.5px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.04);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.25s ease;
    text-decoration: none;
    flex-shrink: 0;
  }

  .back-btn:hover {
    border-color: var(--teal);
    box-shadow: 0 0 12px rgba(78,157,166,0.3);
    background: rgba(78,157,166,0.06);
  }

  .back-btn:active {
    transform: scale(0.92);
  }

  .back-btn svg {
    width: 18px;
    height: 18px;
    fill: none;
    stroke: var(--text-secondary);
    stroke-width: 2;
    stroke-linecap: round;
  }

  .header-text {
    flex: 1;
  }

  .header-title {
    font-size: 22px;
    font-weight: 800;
    color: var(--green);
    text-shadow: 0 0 20px rgba(107,191,107,0.3);
    letter-spacing: -0.3px;
  }

  .header-subtitle {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-dim);
    margin-top: 1px;
  }

  /* Floating picked-items strip */
  .picked-strip {
    padding: 10px 20px 6px;
    position: sticky;
    top: 42px;
    z-index: 45;
    background: var(--bg);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .picked-strip.hidden {
    opacity: 0;
    transform: translateY(-8px);
    pointer-events: none;
    height: 0;
    padding: 0 20px;
    overflow: hidden;
  }

  .picked-row {
    display: flex;
    align-items: center;
    gap: 6px;
    overflow-x: auto;
    scrollbar-width: none;
    padding: 4px 0;
  }

  .picked-row::-webkit-scrollbar {
    display: none;
  }

  .picked-circle {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 1.5px solid var(--teal);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
    background: rgba(78,157,166,0.06);
    box-shadow: 0 0 8px rgba(78,157,166,0.2);
    transition: all 0.25s ease;
    animation: pickedAppear 0.3s ease;
  }

  @keyframes pickedAppear {
    0% {
      opacity: 0;
      transform: scale(0.5);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  .picked-count {
    font-size: 12px;
    font-weight: 700;
    color: var(--teal);
    flex-shrink: 0;
    margin-left: 4px;
    min-width: 20px;
    text-align: center;
  }

  /* Search */
  .search-wrapper {
    padding: 10px 20px 12px;
  }

  .search-bar {
    width: 100%;
    background: rgba(255,255,255,0.05);
    border: 1.5px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    padding: 12px 16px 12px 42px;
    font-size: 14px;
    font-weight: 500;
    font-family: 'Plus Jakarta Sans', sans-serif;
    color: var(--text-primary);
    outline: none;
    transition: all 0.25s ease;
  }

  .search-bar::placeholder {
    color: var(--text-dim);
  }

  .search-bar:focus {
    border-color: var(--teal);
    box-shadow: 0 0 15px rgba(78,157,166,0.2), 0 0 30px rgba(78,157,166,0.05);
    background: rgba(78,157,166,0.04);
  }

  .search-container {
    position: relative;
  }

  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    fill: none;
    stroke: var(--text-dim);
    stroke-width: 2;
    stroke-linecap: round;
    pointer-events: none;
    transition: stroke 0.25s ease;
  }

  .search-bar:focus ~ .search-icon {
    stroke: var(--teal);
  }

  /* Product Grid */
  .grid-wrapper {
    padding: 0 20px;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
  }

  .product-tile {
    aspect-ratio: 1 / 1;
    border-radius: 20px;
    background: rgba(255,255,255,0.04);
    border: 1.5px solid rgba(255,255,255,0.06);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    user-select: none;
    -webkit-user-select: none;
  }

  .product-tile:active {
    transform: scale(0.95);
  }

  .product-tile.selected {
    border-color: var(--teal);
    background: rgba(78,157,166,0.06);
    box-shadow: 0 0 15px rgba(78,157,166,0.25), 0 0 30px rgba(78,157,166,0.1);
  }

  /* Bounce animation on select */
  @keyframes tileBounce {
    0% { transform: scale(1); }
    40% { transform: scale(1.08); }
    70% { transform: scale(0.97); }
    100% { transform: scale(1); }
  }

  .product-tile.bouncing {
    animation: tileBounce 0.28s ease;
  }

  .product-emoji {
    font-size: 28px;
    line-height: 1;
    transition: transform 0.3s ease;
  }

  .product-tile.selected .product-emoji {
    transform: scale(1.05);
  }

  .product-name {
    font-size: 11px;
    font-weight: 700;
    color: var(--text-primary);
    text-align: center;
    line-height: 1.2;
    padding: 0 4px;
  }

  .product-unit {
    font-size: 9px;
    font-weight: 500;
    color: var(--text-dim);
  }

  /* Quantity badge */
  .qty-badge {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--teal);
    color: #fff;
    font-size: 11px;
    font-weight: 700;
    display: none;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 10px rgba(78,157,166,0.4);
    transition: transform 0.2s ease;
  }

  .product-tile.selected .qty-badge {
    display: flex;
  }

  /* Badge pop animation */
  @keyframes badgePop {
    0% { transform: scale(1); }
    50% { transform: scale(1.25); }
    100% { transform: scale(1); }
  }

  .qty-badge.popping {
    animation: badgePop 0.2s ease;
  }

  /* Stepper */
  .stepper {
    position: absolute;
    bottom: 6px;
    left: 50%;
    transform: translateX(-50%);
    display: none;
    align-items: center;
    gap: 0;
    background: rgba(0,0,0,0.6);
    border-radius: 14px;
    border: 1px solid rgba(78,157,166,0.3);
    overflow: hidden;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .product-tile.selected .stepper {
    display: flex;
  }

  .stepper-btn {
    width: 28px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--teal);
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    background: transparent;
    font-family: 'Plus Jakarta Sans', sans-serif;
    transition: background 0.15s, transform 0.1s;
    padding: 0;
  }

  .stepper-btn:hover {
    background: rgba(78,157,166,0.15);
  }

  .stepper-btn:active {
    background: rgba(78,157,166,0.25);
    transform: scale(0.9);
  }

  .stepper-val {
    width: 22px;
    text-align: center;
    font-size: 12px;
    font-weight: 700;
    color: #fff;
  }

  /* Bottom Bar */
  .bottom-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(18,18,22,0.9);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255,255,255,0.06);
    padding: 14px 20px 36px;
    display: flex;
    align-items: center;
    gap: 16px;
    z-index: 100;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .bottom-bar.visible {
    transform: translateY(0);
  }

  .bottom-bar-text {
    flex: 1;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-secondary);
  }

  .bottom-bar-text span {
    color: var(--teal);
    font-weight: 700;
  }

  .fertig-btn {
    background: var(--teal);
    color: #fff;
    border: none;
    border-radius: 16px;
    padding: 12px 28px;
    font-size: 15px;
    font-weight: 700;
    font-family: 'Plus Jakarta Sans', sans-serif;
    cursor: pointer;
    box-shadow: 0 0 20px rgba(78,157,166,0.4), 0 0 40px rgba(78,157,166,0.15);
    transition: all 0.25s ease;
  }

  .fertig-btn:hover {
    box-shadow: 0 0 25px rgba(78,157,166,0.5), 0 0 50px rgba(78,157,166,0.2);
    transform: translateY(-1px);
  }

  .fertig-btn:active {
    transform: scale(0.97);
  }

  /* Empty state for search */
  .no-results {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-dim);
    font-size: 14px;
    font-weight: 500;
    display: none;
  }
</style>
</head>
<body>

<div class="phone-frame">
  <div class="screen">
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-time">9:41</div>
      <div class="status-icons">
        <svg viewBox="0 0 16 16"><path d="M1.5 4.5C4 2 7.5 1 8 1s4 1 6.5 3.5l-1.2 1.2C11.2 3.6 9 2.5 8 2.5S4.8 3.6 2.7 5.7L1.5 4.5zM4 7.3C5.3 6 6.8 5.2 8 5.2s2.7.8 4 2.1L10.8 8.5C9.8 7.5 9 7 8 7s-1.8.5-2.8 1.5L4 7.3zM6.5 10c.8-.8 1.2-1 1.5-1s.7.2 1.5 1L8 11.5 6.5 10z"/></svg>
        <svg viewBox="0 0 16 16"><path d="M1 4h2v8H1V4zm3.5 2h2v6h-2V6zM8 3h2v9H8V3zm3.5 1h2v8h-2V4z"/></svg>
        <svg viewBox="0 0 24 14"><rect x="0.5" y="0.5" width="20" height="13" rx="2.5" stroke="white" stroke-opacity="0.35" fill="none"/><path opacity="0.4" d="M22 5v4a2 2 0 000-4z" fill="white"/><rect x="2" y="2" width="15" height="9" rx="1.5" fill="white"/></svg>
      </div>
    </div>

    <!-- Header -->
    <div class="header">
      <a class="back-btn" href="index.html">
        <svg viewBox="0 0 18 18"><path d="M11 4L6 9l5 5"/></svg>
      </a>
      <div class="header-text">
        <h1 class="header-title">Obst &amp; Gem&uuml;se</h1>
        <p class="header-subtitle" id="productCount">21 Produkte</p>
      </div>
    </div>

    <!-- Floating picked-items strip -->
    <div class="picked-strip hidden" id="pickedStrip">
      <div class="picked-row" id="pickedRow"></div>
    </div>

    <!-- Search -->
    <div class="search-wrapper">
      <div class="search-container">
        <input class="search-bar" type="text" placeholder="Produkt suchen..." id="searchInput">
        <svg class="search-icon" viewBox="0 0 18 18"><circle cx="7.5" cy="7.5" r="5.5"/><path d="M12 12l4 4"/></svg>
      </div>
    </div>

    <!-- Product Grid -->
    <div class="grid-wrapper">
      <div class="product-grid" id="productGrid"></div>
      <div class="no-results" id="noResults">Kein Produkt gefunden</div>
    </div>
  </div>

  <!-- Bottom Bar -->
  <div class="bottom-bar" id="bottomBar">
    <div class="bottom-bar-text"><span id="selectedCount">0</span> ausgew&auml;hlt</div>
    <button class="fertig-btn" id="fertigBtn">Fertig</button>
  </div>
</div>

<script>
  const STORAGE_KEY = 'shopzebra_items_v2';
  const CATEGORY = 'obst-gemuese';

  const ALL_PRODUCTS = [
    { id: 'ananas',      emoji: '\u{1F34D}', name: 'Ananas',       unit: 'St' },
    { id: 'aepfel',      emoji: '\u{1F34E}', name: '\u00c4pfel',        unit: 'kg' },
    { id: 'avocado',     emoji: '\u{1F951}', name: 'Avocado',      unit: 'St' },
    { id: 'bananen',     emoji: '\u{1F34C}', name: 'Bananen',      unit: 'St' },
    { id: 'blaubeeren',  emoji: '\u{1FAD0}', name: 'Blaubeeren',   unit: 'Schale' },
    { id: 'brokkoli',    emoji: '\u{1F966}', name: 'Brokkoli',     unit: 'St' },
    { id: 'champignons', emoji: '\u{1F344}', name: 'Champignons',  unit: '200g' },
    { id: 'erdbeeren',   emoji: '\u{1F353}', name: 'Erdbeeren',    unit: 'Schale' },
    { id: 'gurke',       emoji: '\u{1F952}', name: 'Gurke',        unit: 'St' },
    { id: 'ingwer',      emoji: '\u{1FADA}', name: 'Ingwer',       unit: 'St' },
    { id: 'kartoffeln',  emoji: '\u{1F954}', name: 'Kartoffeln',   unit: 'kg' },
    { id: 'knoblauch',   emoji: '\u{1F9C4}', name: 'Knoblauch',    unit: 'Knolle' },
    { id: 'moehren',     emoji: '\u{1F955}', name: 'M\u00f6hren',       unit: 'kg' },
    { id: 'paprika',     emoji: '\u{1FAD1}', name: 'Paprika',      unit: 'St' },
    { id: 'salat',       emoji: '\u{1F96C}', name: 'Salat',        unit: 'Kopf' },
    { id: 'spinat',      emoji: '\u{1F33F}', name: 'Spinat',       unit: 'Beutel' },
    { id: 'tomaten',     emoji: '\u{1F345}', name: 'Tomaten',      unit: 'kg' },
    { id: 'trauben',     emoji: '\u{1F347}', name: 'Trauben',      unit: 'kg' },
    { id: 'zitronen',    emoji: '\u{1F34B}', name: 'Zitronen',     unit: 'St' },
    { id: 'zucchini',    emoji: '\u{1F952}', name: 'Zucchini',     unit: 'St' },
    { id: 'zwiebeln',    emoji: '\u{1F9C5}', name: 'Zwiebeln',     unit: 'Netz' }
  ];

  const DEFAULT_ITEMS = [
    { id: 'aepfel', emoji: '\u{1F34E}', name: '\u00c4pfel', qty: 2, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'bananen', emoji: '\u{1F34C}', name: 'Bananen', qty: 6, unit: 'St', cat: 'obst-gemuese' },
    { id: 'tomaten', emoji: '\u{1F345}', name: 'Tomaten', qty: 1, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'kartoffeln', emoji: '\u{1F954}', name: 'Kartoffeln', qty: 2, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'gurke', emoji: '\u{1F952}', name: 'Gurke', qty: 2, unit: 'St', cat: 'obst-gemuese' },
    { id: 'paprika', emoji: '\u{1FAD1}', name: 'Paprika', qty: 3, unit: 'St', cat: 'obst-gemuese' },
    { id: 'zwiebeln', emoji: '\u{1F9C5}', name: 'Zwiebeln', qty: 1, unit: 'Netz', cat: 'obst-gemuese' },
    { id: 'salat', emoji: '\u{1F96C}', name: 'Salat', qty: 1, unit: 'Kopf', cat: 'obst-gemuese' },
    { id: 'milch', emoji: '\u{1F95B}', name: 'Milch', qty: 2, unit: 'L', cat: 'milch-kaese' },
    { id: 'gouda', emoji: '\u{1F9C0}', name: 'Gouda', qty: 1, unit: 'Pck', cat: 'milch-kaese' },
    { id: 'jogurt', emoji: '\u{1F95B}', name: 'Joghurt', qty: 4, unit: 'St', cat: 'milch-kaese' },
    { id: 'butter', emoji: '\u{1F9C8}', name: 'Butter', qty: 1, unit: 'St', cat: 'milch-kaese' },
    { id: 'vollkornbrot', emoji: '\u{1F35E}', name: 'Vollkornbrot', qty: 1, unit: 'St', cat: 'brot-gebaeck' },
    { id: 'broetchen', emoji: '\u{1F950}', name: 'Br\u00f6tchen', qty: 6, unit: 'St', cat: 'brot-gebaeck' },
    { id: 'hackfleisch', emoji: '\u{1F969}', name: 'Hackfleisch', qty: 1, unit: '500g', cat: 'fleisch-fisch' },
    { id: 'haehnchen', emoji: '\u{1F357}', name: 'H\u00e4hnchenbrust', qty: 1, unit: '400g', cat: 'fleisch-fisch' },
    { id: 'lachs', emoji: '\u{1F41F}', name: 'Lachs', qty: 1, unit: '200g', cat: 'fleisch-fisch' },
    { id: 'nudeln', emoji: '\u{1F35D}', name: 'Nudeln', qty: 2, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'reis', emoji: '\u{1F35A}', name: 'Reis', qty: 1, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'olivenoel', emoji: '\u{1FAD2}', name: 'Oliven\u00f6l', qty: 1, unit: 'Fl', cat: 'zutaten-gewuerze' },
    { id: 'passierte-tomaten', emoji: '\u{1F96B}', name: 'Passierte Tomaten', qty: 2, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'sojasauce', emoji: '\u{1F962}', name: 'Sojasauce', qty: 1, unit: 'Fl', cat: 'zutaten-gewuerze' }
  ];

  function loadItems() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (!stored) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_ITEMS));
      return [...DEFAULT_ITEMS];
    }
    const parsed = JSON.parse(stored);
    if (parsed.length === 0) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_ITEMS));
      return [...DEFAULT_ITEMS];
    }
    return parsed;
  }

  function saveItems(items) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
  }

  function getCategoryItems(allItems) {
    return allItems.filter(item => item.cat === CATEGORY);
  }

  function getSelectedQty(productId) {
    const items = loadItems();
    const found = items.find(item => item.id === productId && item.cat === CATEGORY);
    return found ? found.qty : 0;
  }

  function setProductQty(productId, qty) {
    const items = loadItems();
    const existingIndex = items.findIndex(item => item.id === productId && item.cat === CATEGORY);
    const product = ALL_PRODUCTS.find(p => p.id === productId);

    if (qty <= 0) {
      if (existingIndex !== -1) {
        items.splice(existingIndex, 1);
      }
    } else {
      if (existingIndex !== -1) {
        items[existingIndex].qty = qty;
      } else if (product) {
        items.push({
          id: product.id,
          emoji: product.emoji,
          name: product.name,
          qty: qty,
          unit: product.unit,
          cat: CATEGORY
        });
      }
    }
    saveItems(items);
  }

  function renderPickedStrip() {
    const items = getCategoryItems(loadItems());
    const strip = document.getElementById('pickedStrip');
    const row = document.getElementById('pickedRow');

    if (items.length === 0) {
      strip.classList.add('hidden');
      return;
    }

    strip.classList.remove('hidden');

    row.innerHTML = items.map(item =>
      `<div class="picked-circle">${item.emoji}</div>`
    ).join('') + `<span class="picked-count">${items.length}</span>`;
  }

  function renderGrid(filter = '') {
    const grid = document.getElementById('productGrid');
    const noResults = document.getElementById('noResults');
    const normalizedFilter = filter.toLowerCase().trim();

    const filtered = normalizedFilter
      ? ALL_PRODUCTS.filter(p => p.name.toLowerCase().includes(normalizedFilter))
      : ALL_PRODUCTS;

    if (filtered.length === 0) {
      grid.innerHTML = '';
      noResults.style.display = 'block';
      return;
    }

    noResults.style.display = 'none';

    grid.innerHTML = filtered.map(product => {
      const qty = getSelectedQty(product.id);
      const isSelected = qty > 0;

      return `
        <div class="product-tile${isSelected ? ' selected' : ''}" data-id="${product.id}">
          <div class="qty-badge">${qty}</div>
          <span class="product-emoji">${product.emoji}</span>
          <span class="product-name">${product.name}</span>
          <span class="product-unit">${product.unit}</span>
          <div class="stepper">
            <button class="stepper-btn" data-action="minus" data-id="${product.id}">&minus;</button>
            <span class="stepper-val">${qty}</span>
            <button class="stepper-btn" data-action="plus" data-id="${product.id}">+</button>
          </div>
        </div>
      `;
    }).join('');

    updateBottomBar();
    updateProductCount(filtered.length);
    renderPickedStrip();
  }

  function updateBottomBar() {
    const items = getCategoryItems(loadItems());
    const bottomBar = document.getElementById('bottomBar');
    const countEl = document.getElementById('selectedCount');

    countEl.textContent = items.length;

    if (items.length > 0) {
      bottomBar.classList.add('visible');
    } else {
      bottomBar.classList.remove('visible');
    }
  }

  function updateProductCount(count) {
    document.getElementById('productCount').textContent = `${count} Produkte`;
  }

  function triggerBounce(tile) {
    tile.classList.remove('bouncing');
    // Force reflow to restart animation
    void tile.offsetWidth;
    tile.classList.add('bouncing');
    tile.addEventListener('animationend', function handler() {
      tile.classList.remove('bouncing');
      tile.removeEventListener('animationend', handler);
    });
  }

  function triggerBadgePop(tile) {
    const badge = tile.querySelector('.qty-badge');
    if (badge) {
      badge.classList.remove('popping');
      void badge.offsetWidth;
      badge.classList.add('popping');
      badge.addEventListener('animationend', function handler() {
        badge.classList.remove('popping');
        badge.removeEventListener('animationend', handler);
      });
    }
  }

  // Event delegation for grid
  document.getElementById('productGrid').addEventListener('click', function(e) {
    // Handle stepper buttons
    const stepperBtn = e.target.closest('.stepper-btn');
    if (stepperBtn) {
      e.stopPropagation();
      const productId = stepperBtn.dataset.id;
      const action = stepperBtn.dataset.action;
      const currentQty = getSelectedQty(productId);

      if (action === 'plus') {
        setProductQty(productId, currentQty + 1);
      } else if (action === 'minus') {
        setProductQty(productId, currentQty - 1);
      }

      const searchVal = document.getElementById('searchInput').value;
      renderGrid(searchVal);

      // Trigger badge pop on the tile if it's still selected
      if (action === 'plus' || (action === 'minus' && currentQty > 1)) {
        const tile = document.querySelector(`.product-tile[data-id="${productId}"]`);
        if (tile) {
          triggerBadgePop(tile);
        }
      }
      return;
    }

    // Handle tile click
    const tile = e.target.closest('.product-tile');
    if (tile) {
      const productId = tile.dataset.id;
      const currentQty = getSelectedQty(productId);

      if (currentQty === 0) {
        setProductQty(productId, 1);
        const searchVal = document.getElementById('searchInput').value;
        renderGrid(searchVal);

        // Bounce the newly selected tile
        const newTile = document.querySelector(`.product-tile[data-id="${productId}"]`);
        if (newTile) {
          triggerBounce(newTile);
        }
      } else {
        setProductQty(productId, 0);
        const searchVal = document.getElementById('searchInput').value;
        renderGrid(searchVal);
      }
    }
  });

  // Search
  document.getElementById('searchInput').addEventListener('input', function() {
    renderGrid(this.value);
  });

  // Fertig button
  document.getElementById('fertigBtn').addEventListener('click', function() {
    window.location.href = 'index.html';
  });

  // Initialize
  (function init() {
    const items = loadItems();
    const catItems = getCategoryItems(items);

    // If there are no items at all, the loadItems() already handled defaults
    renderGrid();
  })();
</script>

</body>
</html>
