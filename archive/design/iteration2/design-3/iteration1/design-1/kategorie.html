<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Variant A: Compact & Scannable - Obst & Gem&uuml;se</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #121216;
    --surface: rgba(255,255,255,0.04);
    --teal: #4E9DA6;
    --teal-glow: 0 0 15px rgba(78,157,166,0.4), 0 0 30px rgba(78,157,166,0.15);
    --orange: #E8923A;
    --orange-glow: 0 0 12px rgba(232,146,58,0.5);
    --green: #6BBF6B;
    --text-primary: #ffffff;
    --text-secondary: rgba(255,255,255,0.5);
    --text-dim: rgba(255,255,255,0.35);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    background: #0a0a0e;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: 'Plus Jakarta Sans', sans-serif;
    color: var(--text-primary);
  }

  .phone-frame {
    width: 390px;
    height: 844px;
    background: var(--bg);
    border-radius: 44px;
    overflow: hidden;
    position: relative;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 0 60px rgba(0,0,0,0.5), 0 0 120px rgba(78,157,166,0.05);
  }

  .screen {
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    padding-bottom: 110px;
    scrollbar-width: none;
  }

  .screen::-webkit-scrollbar {
    display: none;
  }

  /* Status Bar */
  .status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 28px 8px;
    position: sticky;
    top: 0;
    z-index: 50;
    background: var(--bg);
  }

  .status-time {
    font-size: 15px;
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .status-icons {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .status-icons svg {
    width: 16px;
    height: 16px;
    fill: white;
  }

  /* Header */
  .header {
    display: flex;
    align-items: center;
    padding: 8px 20px 4px;
    gap: 14px;
  }

  .back-btn {
    width: 40px;
    height: 40px;
    border-radius: 14px;
    border: 1.5px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.04);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.25s ease;
    text-decoration: none;
    flex-shrink: 0;
  }

  .back-btn:hover {
    border-color: var(--teal);
    box-shadow: 0 0 12px rgba(78,157,166,0.3);
    background: rgba(78,157,166,0.06);
  }

  .back-btn svg {
    width: 18px;
    height: 18px;
    fill: none;
    stroke: var(--text-secondary);
    stroke-width: 2;
    stroke-linecap: round;
  }

  .header-text {
    flex: 1;
  }

  .header-title {
    font-size: 22px;
    font-weight: 800;
    color: var(--green);
    text-shadow: 0 0 20px rgba(107,191,107,0.3);
    letter-spacing: -0.3px;
  }

  .header-subtitle {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-dim);
    margin-top: 1px;
  }

  /* Sticky Selected Summary Bar */
  .selected-summary {
    position: sticky;
    top: 42px;
    z-index: 45;
    background: rgba(18,18,22,0.92);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-bottom: 1px solid rgba(255,255,255,0.06);
    padding: 8px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    min-height: 44px;
    transition: opacity 0.25s ease;
  }

  .selected-summary.hidden {
    opacity: 0;
    pointer-events: none;
    min-height: 0;
    padding: 0 20px;
    border: none;
  }

  .summary-emojis {
    display: flex;
    align-items: center;
    gap: 4px;
    flex: 1;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .summary-emojis::-webkit-scrollbar {
    display: none;
  }

  .summary-emoji-circle {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(78,157,166,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
    transition: all 0.2s ease;
  }

  .summary-count {
    font-size: 12px;
    font-weight: 700;
    color: var(--teal);
    white-space: nowrap;
    flex-shrink: 0;
  }

  /* Search */
  .search-wrapper {
    padding: 12px 20px 10px;
  }

  .search-bar {
    width: 100%;
    background: rgba(255,255,255,0.05);
    border: 1.5px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    padding: 12px 16px 12px 42px;
    font-size: 14px;
    font-weight: 500;
    font-family: 'Plus Jakarta Sans', sans-serif;
    color: var(--text-primary);
    outline: none;
    transition: all 0.25s ease;
  }

  .search-bar::placeholder {
    color: var(--text-dim);
  }

  .search-bar:focus {
    border-color: var(--teal);
    box-shadow: 0 0 15px rgba(78,157,166,0.2), 0 0 30px rgba(78,157,166,0.05);
    background: rgba(78,157,166,0.04);
  }

  .search-container {
    position: relative;
  }

  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    fill: none;
    stroke: var(--text-dim);
    stroke-width: 2;
    stroke-linecap: round;
    pointer-events: none;
  }

  /* Product Grid - TALLER TILES (4:5) */
  .grid-wrapper {
    padding: 0 20px;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
  }

  .product-tile {
    aspect-ratio: 4 / 5;
    border-radius: 20px;
    background: rgba(255,255,255,0.04);
    border: 1.5px solid rgba(255,255,255,0.06);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    user-select: none;
    padding: 8px 4px;
  }

  .product-tile:active {
    transform: scale(0.95);
  }

  .product-tile.selected {
    border-color: var(--teal);
    background: rgba(78,157,166,0.06);
    box-shadow: 0 0 15px rgba(78,157,166,0.25), 0 0 30px rgba(78,157,166,0.1);
  }

  .product-emoji {
    font-size: 30px;
    line-height: 1;
    transition: transform 0.3s ease;
  }

  .product-tile.selected .product-emoji {
    transform: scale(1.08);
  }

  .product-name {
    font-size: 12px;
    font-weight: 700;
    color: var(--text-primary);
    text-align: center;
    line-height: 1.25;
    padding: 0 4px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    max-height: 30px;
  }

  .product-unit {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-dim);
  }

  /* Quantity badge */
  .qty-badge {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--teal);
    color: #fff;
    font-size: 11px;
    font-weight: 700;
    display: none;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 10px rgba(78,157,166,0.4);
  }

  .product-tile.selected .qty-badge {
    display: flex;
  }

  /* Stepper */
  .stepper {
    position: absolute;
    bottom: 6px;
    left: 50%;
    transform: translateX(-50%);
    display: none;
    align-items: center;
    gap: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-radius: 14px;
    border: 1px solid rgba(78,157,166,0.3);
    overflow: hidden;
  }

  .product-tile.selected .stepper {
    display: flex;
  }

  .stepper-btn {
    width: 30px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--teal);
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    background: transparent;
    font-family: 'Plus Jakarta Sans', sans-serif;
    transition: background 0.15s;
    padding: 0;
  }

  .stepper-btn:hover {
    background: rgba(78,157,166,0.15);
  }

  .stepper-btn:active {
    background: rgba(78,157,166,0.25);
  }

  .stepper-val {
    width: 24px;
    text-align: center;
    font-size: 12px;
    font-weight: 700;
    color: #fff;
  }

  /* Bottom Bar */
  .bottom-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(18,18,22,0.9);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255,255,255,0.06);
    padding: 14px 20px 36px;
    display: flex;
    align-items: center;
    gap: 16px;
    z-index: 100;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .bottom-bar.visible {
    transform: translateY(0);
  }

  .bottom-bar-text {
    flex: 1;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-secondary);
  }

  .bottom-bar-text span {
    color: var(--teal);
    font-weight: 700;
  }

  .fertig-btn {
    background: var(--teal);
    color: #fff;
    border: none;
    border-radius: 16px;
    padding: 12px 28px;
    font-size: 15px;
    font-weight: 700;
    font-family: 'Plus Jakarta Sans', sans-serif;
    cursor: pointer;
    box-shadow: 0 0 20px rgba(78,157,166,0.4), 0 0 40px rgba(78,157,166,0.15);
    transition: all 0.25s ease;
  }

  .fertig-btn:hover {
    box-shadow: 0 0 25px rgba(78,157,166,0.5), 0 0 50px rgba(78,157,166,0.2);
    transform: translateY(-1px);
  }

  .fertig-btn:active {
    transform: scale(0.97);
  }

  /* Empty state for search */
  .no-results {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-dim);
    font-size: 14px;
    font-weight: 500;
    display: none;
  }
</style>
</head>
<body>

<div class="phone-frame">
  <div class="screen">
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-time">9:41</div>
      <div class="status-icons">
        <svg viewBox="0 0 16 16"><path d="M1.5 4.5C4 2 7.5 1 8 1s4 1 6.5 3.5l-1.2 1.2C11.2 3.6 9 2.5 8 2.5S4.8 3.6 2.7 5.7L1.5 4.5zM4 7.3C5.3 6 6.8 5.2 8 5.2s2.7.8 4 2.1L10.8 8.5C9.8 7.5 9 7 8 7s-1.8.5-2.8 1.5L4 7.3zM6.5 10c.8-.8 1.2-1 1.5-1s.7.2 1.5 1L8 11.5 6.5 10z"/></svg>
        <svg viewBox="0 0 16 16"><path d="M1 4h2v8H1V4zm3.5 2h2v6h-2V6zM8 3h2v9H8V3zm3.5 1h2v8h-2V4z"/></svg>
        <svg viewBox="0 0 24 14"><rect x="0.5" y="0.5" width="20" height="13" rx="2.5" stroke="white" stroke-opacity="0.35" fill="none"/><path opacity="0.4" d="M22 5v4a2 2 0 000-4z" fill="white"/><rect x="2" y="2" width="15" height="9" rx="1.5" fill="white"/></svg>
      </div>
    </div>

    <!-- Header -->
    <div class="header">
      <a class="back-btn" href="index.html">
        <svg viewBox="0 0 18 18"><path d="M11 4L6 9l5 5"/></svg>
      </a>
      <div class="header-text">
        <h1 class="header-title">Obst & Gem&uuml;se</h1>
        <p class="header-subtitle" id="productCount">21 Produkte</p>
      </div>
    </div>

    <!-- Sticky Selected Summary Bar -->
    <div class="selected-summary hidden" id="selectedSummary">
      <div class="summary-emojis" id="summaryEmojis"></div>
      <div class="summary-count" id="summaryCount">0 von 21</div>
    </div>

    <!-- Search -->
    <div class="search-wrapper">
      <div class="search-container">
        <svg class="search-icon" viewBox="0 0 18 18"><circle cx="7.5" cy="7.5" r="5.5"/><path d="M12 12l4 4"/></svg>
        <input class="search-bar" type="text" placeholder="Produkt suchen..." id="searchInput">
      </div>
    </div>

    <!-- Product Grid -->
    <div class="grid-wrapper">
      <div class="product-grid" id="productGrid"></div>
      <div class="no-results" id="noResults">Kein Produkt gefunden</div>
    </div>
  </div>

  <!-- Bottom Bar -->
  <div class="bottom-bar" id="bottomBar">
    <div class="bottom-bar-text"><span id="selectedCount">0</span> ausgew&auml;hlt</div>
    <button class="fertig-btn" id="fertigBtn">Fertig</button>
  </div>
</div>

<script>
  const STORAGE_KEY = 'shopzebra_items_v2';
  const CATEGORY = 'obst-gemuese';
  const TOTAL_PRODUCTS = 21;

  const ALL_PRODUCTS = [
    { id: 'ananas',      emoji: '\uD83C\uDF4D', name: 'Ananas',       unit: 'St' },
    { id: 'aepfel',      emoji: '\uD83C\uDF4E', name: '\u00c4pfel',   unit: 'kg' },
    { id: 'avocado',     emoji: '\uD83E\uDD51', name: 'Avocado',      unit: 'St' },
    { id: 'bananen',     emoji: '\uD83C\uDF4C', name: 'Bananen',      unit: 'St' },
    { id: 'blaubeeren',  emoji: '\uD83E\uDED0', name: 'Blaubeeren',   unit: 'Schale' },
    { id: 'brokkoli',    emoji: '\uD83E\uDD66', name: 'Brokkoli',     unit: 'St' },
    { id: 'champignons', emoji: '\uD83C\uDF44', name: 'Champignons',  unit: '200g' },
    { id: 'erdbeeren',   emoji: '\uD83C\uDF53', name: 'Erdbeeren',    unit: 'Schale' },
    { id: 'gurke',       emoji: '\uD83E\uDD52', name: 'Gurke',        unit: 'St' },
    { id: 'ingwer',      emoji: '\uD83E\uDEDA', name: 'Ingwer',       unit: 'St' },
    { id: 'kartoffeln',  emoji: '\uD83E\uDD54', name: 'Kartoffeln',   unit: 'kg' },
    { id: 'knoblauch',   emoji: '\uD83E\uDDC4', name: 'Knoblauch',    unit: 'Knolle' },
    { id: 'moehren',     emoji: '\uD83E\uDD55', name: 'M\u00f6hren',  unit: 'kg' },
    { id: 'paprika',     emoji: '\uD83E\uDED1', name: 'Paprika',      unit: 'St' },
    { id: 'salat',       emoji: '\uD83E\uDD6C', name: 'Salat',        unit: 'Kopf' },
    { id: 'spinat',      emoji: '\uD83C\uDF3F', name: 'Spinat',       unit: 'Beutel' },
    { id: 'tomaten',     emoji: '\uD83C\uDF45', name: 'Tomaten',      unit: 'kg' },
    { id: 'trauben',     emoji: '\uD83C\uDF47', name: 'Trauben',      unit: 'kg' },
    { id: 'zitronen',    emoji: '\uD83C\uDF4B', name: 'Zitronen',     unit: 'St' },
    { id: 'zucchini',    emoji: '\uD83E\uDD52', name: 'Zucchini',     unit: 'St' },
    { id: 'zwiebeln',    emoji: '\uD83E\uDDC5', name: 'Zwiebeln',     unit: 'Netz' }
  ];

  // The 8 pre-selected items matching DEFAULT_ITEMS from index.html
  const DEFAULT_SELECTIONS = [
    { id: 'aepfel', emoji: '\uD83C\uDF4E', name: '\u00c4pfel', qty: 2, unit: 'kg', cat: CATEGORY },
    { id: 'bananen', emoji: '\uD83C\uDF4C', name: 'Bananen', qty: 6, unit: 'St', cat: CATEGORY },
    { id: 'tomaten', emoji: '\uD83C\uDF45', name: 'Tomaten', qty: 1, unit: 'kg', cat: CATEGORY },
    { id: 'kartoffeln', emoji: '\uD83E\uDD54', name: 'Kartoffeln', qty: 2, unit: 'kg', cat: CATEGORY },
    { id: 'gurke', emoji: '\uD83E\uDD52', name: 'Gurke', qty: 2, unit: 'St', cat: CATEGORY },
    { id: 'paprika', emoji: '\uD83E\uDED1', name: 'Paprika', qty: 3, unit: 'St', cat: CATEGORY },
    { id: 'zwiebeln', emoji: '\uD83E\uDDC5', name: 'Zwiebeln', qty: 1, unit: 'Netz', cat: CATEGORY },
    { id: 'salat', emoji: '\uD83E\uDD6C', name: 'Salat', qty: 1, unit: 'Kopf', cat: CATEGORY }
  ];

  // Full 22-item default set for the whole app (matches index.html)
  const FULL_DEFAULT_ITEMS = [
    { id: 'aepfel', emoji: '\uD83C\uDF4E', name: '\u00c4pfel', qty: 2, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'bananen', emoji: '\uD83C\uDF4C', name: 'Bananen', qty: 6, unit: 'St', cat: 'obst-gemuese' },
    { id: 'tomaten', emoji: '\uD83C\uDF45', name: 'Tomaten', qty: 1, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'kartoffeln', emoji: '\uD83E\uDD54', name: 'Kartoffeln', qty: 2, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'gurke', emoji: '\uD83E\uDD52', name: 'Gurke', qty: 2, unit: 'St', cat: 'obst-gemuese' },
    { id: 'paprika', emoji: '\uD83E\uDED1', name: 'Paprika', qty: 3, unit: 'St', cat: 'obst-gemuese' },
    { id: 'zwiebeln', emoji: '\uD83E\uDDC5', name: 'Zwiebeln', qty: 1, unit: 'Netz', cat: 'obst-gemuese' },
    { id: 'salat', emoji: '\uD83E\uDD6C', name: 'Salat', qty: 1, unit: 'Kopf', cat: 'obst-gemuese' },
    { id: 'milch', emoji: '\uD83E\uDD5B', name: 'Milch', qty: 2, unit: 'L', cat: 'milch-kaese' },
    { id: 'gouda', emoji: '\uD83E\uDDC0', name: 'Gouda', qty: 1, unit: 'Pck', cat: 'milch-kaese' },
    { id: 'jogurt', emoji: '\uD83E\uDD5B', name: 'Joghurt', qty: 4, unit: 'St', cat: 'milch-kaese' },
    { id: 'butter', emoji: '\uD83E\uDDC8', name: 'Butter', qty: 1, unit: 'St', cat: 'milch-kaese' },
    { id: 'vollkornbrot', emoji: '\uD83C\uDF5E', name: 'Vollkornbrot', qty: 1, unit: 'St', cat: 'brot-gebaeck' },
    { id: 'broetchen', emoji: '\uD83E\uDD50', name: 'Br\u00f6tchen', qty: 6, unit: 'St', cat: 'brot-gebaeck' },
    { id: 'hackfleisch', emoji: '\uD83E\uDD69', name: 'Hackfleisch', qty: 1, unit: '500g', cat: 'fleisch-fisch' },
    { id: 'haehnchen', emoji: '\uD83C\uDF57', name: 'H\u00e4hnchenbrust', qty: 1, unit: '400g', cat: 'fleisch-fisch' },
    { id: 'lachs', emoji: '\uD83D\uDC1F', name: 'Lachs', qty: 1, unit: '200g', cat: 'fleisch-fisch' },
    { id: 'nudeln', emoji: '\uD83C\uDF5D', name: 'Nudeln', qty: 2, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'reis', emoji: '\uD83C\uDF5A', name: 'Reis', qty: 1, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'olivenoel', emoji: '\uD83E\uDED2', name: 'Oliven\u00f6l', qty: 1, unit: 'Fl', cat: 'zutaten-gewuerze' },
    { id: 'passierte-tomaten', emoji: '\uD83E\uDD6B', name: 'Passierte Tomaten', qty: 2, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'sojasauce', emoji: '\uD83E\uDD62', name: 'Sojasauce', qty: 1, unit: 'Fl', cat: 'zutaten-gewuerze' }
  ];

  function loadItems() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (!stored) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(FULL_DEFAULT_ITEMS));
      return [...FULL_DEFAULT_ITEMS];
    }
    const parsed = JSON.parse(stored);
    return parsed.length > 0 ? parsed : [...FULL_DEFAULT_ITEMS];
  }

  function saveItems(items) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
  }

  function getCategoryItems(allItems) {
    return allItems.filter(function(item) { return item.cat === CATEGORY; });
  }

  function getSelectedQty(productId) {
    const items = loadItems();
    const found = items.find(function(item) { return item.id === productId && item.cat === CATEGORY; });
    return found ? found.qty : 0;
  }

  function setProductQty(productId, qty) {
    const items = loadItems();
    const existingIndex = items.findIndex(function(item) { return item.id === productId && item.cat === CATEGORY; });
    const product = ALL_PRODUCTS.find(function(p) { return p.id === productId; });

    if (qty <= 0) {
      if (existingIndex !== -1) {
        items.splice(existingIndex, 1);
      }
    } else {
      if (existingIndex !== -1) {
        items[existingIndex].qty = qty;
      } else if (product) {
        items.push({
          id: product.id,
          emoji: product.emoji,
          name: product.name,
          qty: qty,
          unit: product.unit,
          cat: CATEGORY
        });
      }
    }
    saveItems(items);
  }

  function renderSummaryBar() {
    const items = getCategoryItems(loadItems());
    const summaryEl = document.getElementById('selectedSummary');
    const emojisEl = document.getElementById('summaryEmojis');
    const countEl = document.getElementById('summaryCount');

    if (items.length === 0) {
      summaryEl.classList.add('hidden');
      return;
    }

    summaryEl.classList.remove('hidden');
    countEl.textContent = items.length + ' von ' + TOTAL_PRODUCTS;

    emojisEl.innerHTML = items.map(function(item) {
      return '<div class="summary-emoji-circle">' + item.emoji + '</div>';
    }).join('');
  }

  function renderGrid(filter) {
    filter = filter || '';
    const grid = document.getElementById('productGrid');
    const noResults = document.getElementById('noResults');
    const normalizedFilter = filter.toLowerCase().trim();

    const filtered = normalizedFilter
      ? ALL_PRODUCTS.filter(function(p) { return p.name.toLowerCase().indexOf(normalizedFilter) !== -1; })
      : ALL_PRODUCTS;

    if (filtered.length === 0) {
      grid.innerHTML = '';
      noResults.style.display = 'block';
      return;
    }

    noResults.style.display = 'none';

    grid.innerHTML = filtered.map(function(product) {
      const qty = getSelectedQty(product.id);
      const isSelected = qty > 0;

      return '<div class="product-tile' + (isSelected ? ' selected' : '') + '" data-id="' + product.id + '">' +
        '<div class="qty-badge">' + qty + '</div>' +
        '<span class="product-emoji">' + product.emoji + '</span>' +
        '<span class="product-name">' + product.name + '</span>' +
        '<span class="product-unit">' + product.unit + '</span>' +
        '<div class="stepper">' +
          '<button class="stepper-btn" data-action="minus" data-id="' + product.id + '">&minus;</button>' +
          '<span class="stepper-val">' + qty + '</span>' +
          '<button class="stepper-btn" data-action="plus" data-id="' + product.id + '">+</button>' +
        '</div>' +
      '</div>';
    }).join('');

    updateBottomBar();
    updateProductCount(filtered.length);
    renderSummaryBar();
  }

  function updateBottomBar() {
    const items = getCategoryItems(loadItems());
    const bottomBar = document.getElementById('bottomBar');
    const countEl = document.getElementById('selectedCount');

    countEl.textContent = items.length;

    if (items.length > 0) {
      bottomBar.classList.add('visible');
    } else {
      bottomBar.classList.remove('visible');
    }
  }

  function updateProductCount(count) {
    document.getElementById('productCount').textContent = count + ' Produkte';
  }

  // Event delegation for grid
  document.getElementById('productGrid').addEventListener('click', function(e) {
    // Handle stepper buttons
    const stepperBtn = e.target.closest('.stepper-btn');
    if (stepperBtn) {
      e.stopPropagation();
      const productId = stepperBtn.dataset.id;
      const action = stepperBtn.dataset.action;
      const currentQty = getSelectedQty(productId);

      if (action === 'plus') {
        setProductQty(productId, currentQty + 1);
      } else if (action === 'minus') {
        setProductQty(productId, currentQty - 1);
      }

      const searchVal = document.getElementById('searchInput').value;
      renderGrid(searchVal);
      return;
    }

    // Handle tile click (tap body to toggle selection)
    const tile = e.target.closest('.product-tile');
    if (tile) {
      const productId = tile.dataset.id;
      const currentQty = getSelectedQty(productId);

      if (currentQty === 0) {
        setProductQty(productId, 1);
      } else {
        setProductQty(productId, 0);
      }

      const searchVal = document.getElementById('searchInput').value;
      renderGrid(searchVal);
    }
  });

  // Search
  document.getElementById('searchInput').addEventListener('input', function() {
    renderGrid(this.value);
  });

  // Fertig button
  document.getElementById('fertigBtn').addEventListener('click', function() {
    window.location.href = 'index.html';
  });

  // Initialize
  (function init() {
    const items = loadItems();
    const catItems = getCategoryItems(items);

    // If no items at all in storage, seed with the full 22-item default
    if (items.length === 0) {
      saveItems(FULL_DEFAULT_ITEMS);
    }

    renderGrid();
  })();
</script>

</body>
</html>
