<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShopZebra - Design 3: Split View</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  /* ===== Theme Variables ===== */
  [data-theme="dark"] {
    --body-bg: #0a0a0e;
    --screen-bg: #121216;
    --screen-gradient: none;
    --surface: rgba(255,255,255,0.04);
    --surface-hover: rgba(255,255,255,0.06);
    --surface-border: rgba(255,255,255,0.06);
    --teal: #4E9DA6;
    --orange: #E8923A;
    --text-primary: #ffffff;
    --text-secondary: rgba(255,255,255,0.5);
    --text-dim: rgba(255,255,255,0.35);
    --card-bg: rgba(255,255,255,0.03);
    --card-border: rgba(255,255,255,0.06);
    --card-blur: 0px;
    --chip-bg: rgba(255,255,255,0.06);
    --chip-border: rgba(255,255,255,0.08);
    --chip-blur: 0px;
    --frame-shadow: 0 0 60px rgba(0,0,0,0.5), 0 0 120px rgba(78,157,166,0.05);
    --frame-border: 1px solid rgba(255,255,255,0.08);
    --frame-outline: none;
    --nav-bg: rgba(18,18,22,0.85);
    --nav-blur: blur(20px);
    --nav-border: rgba(255,255,255,0.06);
    --badge-bg: var(--orange);
    --badge-color: #fff;
    --badge-border: none;
    --badge-shadow: 0 0 8px rgba(232,146,58,0.3);
    --green-accent: #6BBF6B;
    --progress-bg: rgba(255,255,255,0.06);
    --progress-fill: linear-gradient(90deg, var(--teal), var(--orange));
    --cart-section-bg: rgba(255,255,255,0.02);
    --cart-section-border: rgba(255,255,255,0.04);
    --celebration-glow: rgba(232,146,58,0.15);
  }

  [data-theme="glass"] {
    --body-bg: #1a1a2e;
    --screen-bg: #0a0a12;
    --screen-gradient:
      radial-gradient(ellipse at 20% 80%, rgba(120, 50, 180, 0.35) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, rgba(50, 120, 180, 0.3) 0%, transparent 60%),
      radial-gradient(ellipse at 50% 50%, rgba(180, 50, 120, 0.2) 0%, transparent 60%),
      radial-gradient(ellipse at 10% 20%, rgba(139, 92, 246, 0.2) 0%, transparent 50%),
      radial-gradient(ellipse at 90% 80%, rgba(59, 130, 246, 0.18) 0%, transparent 50%);
    --surface: rgba(255,255,255,0.06);
    --surface-hover: rgba(255,255,255,0.09);
    --surface-border: rgba(255,255,255,0.1);
    --teal: #4E9DA6;
    --orange: #E8923A;
    --text-primary: #ffffff;
    --text-secondary: rgba(255,255,255,0.5);
    --text-dim: rgba(255,255,255,0.35);
    --card-bg: rgba(255,255,255,0.06);
    --card-border: rgba(255,255,255,0.1);
    --card-blur: blur(20px);
    --chip-bg: rgba(255,255,255,0.06);
    --chip-border: rgba(255,255,255,0.08);
    --chip-blur: blur(12px);
    --frame-shadow: 0 0 0 2px rgba(255,255,255,0.08), 0 40px 80px rgba(0,0,0,0.6), 0 0 120px rgba(139,92,246,0.15), 0 0 80px rgba(236,72,153,0.1);
    --frame-border: none;
    --frame-outline: none;
    --nav-bg: rgba(10,10,18,0.7);
    --nav-blur: blur(24px);
    --nav-border: rgba(255,255,255,0.06);
    --badge-bg: rgba(232,146,58,0.2);
    --badge-color: #E8923A;
    --badge-border: 1px solid rgba(232,146,58,0.25);
    --badge-shadow: none;
    --green-accent: #6BBF6B;
    --progress-bg: rgba(255,255,255,0.08);
    --progress-fill: linear-gradient(90deg, var(--teal), var(--orange));
    --cart-section-bg: rgba(255,255,255,0.03);
    --cart-section-border: rgba(255,255,255,0.06);
    --celebration-glow: rgba(139,92,246,0.2);
  }

  /* ===== Reset ===== */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  /* ===== Body ===== */
  body {
    background: var(--body-bg);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
    color: var(--text-primary);
  }

  /* ===== Phone Frame ===== */
  .phone-frame {
    width: 390px;
    height: 844px;
    background: var(--screen-bg);
    border-radius: 44px;
    overflow: hidden;
    position: relative;
    border: var(--frame-border);
    box-shadow: var(--frame-shadow);
    display: flex;
    flex-direction: column;
  }

  /* ===== Screen ===== */
  .screen {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background-color: var(--screen-bg);
    background-image: var(--screen-gradient);
  }

  /* ===== Status Bar ===== */
  .status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 28px 8px;
    flex-shrink: 0;
    background: var(--screen-bg);
  }
  .status-time {
    font-size: 15px;
    font-weight: 700;
    letter-spacing: 0.5px;
    color: var(--text-primary);
  }
  .status-icons {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .status-icons svg {
    width: 16px;
    height: 16px;
    fill: white;
  }

  /* ===== Theme Toggle ===== */
  .theme-toggle {
    width: 20px;
    height: 20px;
    background: transparent;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.5;
    transition: opacity 0.2s ease;
    padding: 0;
    margin: 0 6px;
  }
  .theme-toggle:hover { opacity: 0.85; }
  .theme-toggle svg { width: 16px; height: 16px; fill: white; }

  /* ===== Header ===== */
  .header {
    padding: 4px 20px 12px;
    flex-shrink: 0;
  }
  .header-top {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 2px;
  }
  .header-title {
    font-size: 20px;
    font-weight: 800;
    color: var(--text-primary);
    letter-spacing: -0.3px;
  }
  .header-subtitle {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-dim);
    padding-left: 48px;
  }

  /* ===== Back Link ===== */
  .nav-back {
    display: flex;
    align-items: center;
    gap: 6px;
    background: none;
    border: none;
    color: var(--teal);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    font-family: inherit;
    text-decoration: none;
    flex-shrink: 0;
  }
  .nav-back svg { width: 20px; height: 20px; fill: var(--teal); }

  /* ===== Split View Layout ===== */
  .split-view {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: 0 16px;
    gap: 0;
    min-height: 0;
  }

  /* ===== Top Section: Noch einkaufen ===== */
  .section-top {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
  }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 4px 8px;
    flex-shrink: 0;
  }
  .section-title {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .section-count {
    background: var(--badge-bg);
    color: var(--badge-color);
    font-size: 11px;
    font-weight: 700;
    padding: 2px 10px;
    border-radius: 20px;
    border: var(--badge-border);
    box-shadow: var(--badge-shadow);
  }

  .top-grid-wrapper {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: none;
    padding-bottom: 4px;
  }
  .top-grid-wrapper::-webkit-scrollbar { display: none; }

  .top-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
  }

  /* Top tile: same style as warenkorb tiles in liste.html */
  .top-tile {
    position: relative;
    padding: 10px 4px 8px;
    border-radius: 14px;
    background: var(--surface);
    border: 1px solid var(--surface-border);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 3px;
    cursor: pointer;
    backdrop-filter: var(--chip-blur);
    -webkit-backdrop-filter: var(--chip-blur);
    transition: transform 0.2s ease, opacity 0.2s ease, background 0.25s ease, box-shadow 0.25s ease;
    user-select: none;
    -webkit-user-select: none;
    min-height: 72px;
  }
  .top-tile:hover {
    background: var(--surface-hover);
    box-shadow: 0 0 10px rgba(78,157,166,0.15);
  }
  .top-tile:active {
    transform: scale(0.93);
  }
  .top-tile.checking-off {
    animation: checkOffTop 0.45s ease forwards;
    pointer-events: none;
  }

  @keyframes checkOffTop {
    0% { transform: scale(1); opacity: 1; }
    30% { transform: scale(1.08); opacity: 1; }
    100% { transform: scale(0.3); opacity: 0; }
  }

  .tile-qty {
    position: absolute;
    top: 4px;
    right: 4px;
    font-size: 9px;
    font-weight: 700;
    color: var(--teal);
    background: rgba(78,157,166,0.15);
    padding: 1px 5px;
    border-radius: 8px;
    line-height: 1.2;
  }
  .tile-emoji {
    font-size: 24px;
    line-height: 1;
  }
  .tile-name {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-secondary);
    text-align: center;
    max-width: 100%;
    padding: 0 4px;
    line-height: 1.2;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* ===== Progress Bar ===== */
  .progress-section {
    flex-shrink: 0;
    padding: 10px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  .progress-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-dim);
    letter-spacing: 0.3px;
  }
  .progress-bar-track {
    width: 100%;
    height: 4px;
    background: var(--progress-bg);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
  }
  .progress-bar-fill {
    height: 100%;
    border-radius: 4px;
    background: var(--progress-fill);
    width: 0%;
    transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1);
    position: relative;
  }
  .progress-bar-fill::after {
    content: '';
    position: absolute;
    right: 0;
    top: -2px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--orange);
    box-shadow: 0 0 8px rgba(232,146,58,0.5);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .progress-bar-fill.active::after {
    opacity: 1;
  }

  /* ===== Bottom Section: Im Wagen ===== */
  .section-bottom {
    flex: 0 1 auto;
    display: flex;
    flex-direction: column;
    min-height: 80px;
    max-height: 50%;
    overflow: hidden;
    background: var(--cart-section-bg);
    border: 1px solid var(--cart-section-border);
    border-radius: 18px;
    margin-bottom: 8px;
    transition: background 0.4s ease, min-height 0.5s ease;
  }
  .section-bottom.has-items {
    min-height: 120px;
  }

  .section-bottom .section-header {
    padding: 10px 12px 6px;
  }
  .cart-count {
    background: rgba(107,191,107,0.15);
    color: var(--green-accent);
    font-size: 11px;
    font-weight: 700;
    padding: 2px 10px;
    border-radius: 20px;
  }

  .bottom-grid-wrapper {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: none;
    padding: 0 8px 8px;
  }
  .bottom-grid-wrapper::-webkit-scrollbar { display: none; }

  .bottom-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 5px;
  }

  /* Bottom tile: smaller, more compact */
  .bottom-tile {
    position: relative;
    padding: 6px 2px 5px;
    border-radius: 10px;
    background: rgba(107,191,107,0.08);
    border: 1px solid rgba(107,191,107,0.12);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1px;
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease, background 0.25s ease;
    user-select: none;
    -webkit-user-select: none;
    min-height: 54px;
  }
  .bottom-tile:hover {
    background: rgba(107,191,107,0.14);
  }
  .bottom-tile:active {
    transform: scale(0.93);
  }
  .bottom-tile .tile-emoji {
    font-size: 18px;
  }
  .bottom-tile .tile-name {
    font-size: 8px;
    color: rgba(255,255,255,0.4);
  }
  .bottom-tile .tile-qty {
    font-size: 8px;
    top: 2px;
    right: 2px;
    padding: 0px 4px;
    color: var(--green-accent);
    background: rgba(107,191,107,0.15);
  }
  .bottom-tile.arriving {
    animation: arriveInCart 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }
  @keyframes arriveInCart {
    0% { transform: scale(0.3); opacity: 0; }
    60% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
  }
  .bottom-tile.returning {
    animation: returnFromCart 0.35s ease forwards;
    pointer-events: none;
  }
  @keyframes returnFromCart {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(0.3); opacity: 0; }
  }

  /* Check mark overlay on bottom tiles */
  .bottom-tile::after {
    content: '\2713';
    position: absolute;
    bottom: 2px;
    right: 3px;
    font-size: 8px;
    color: var(--green-accent);
    opacity: 0.5;
  }

  /* ===== Empty State ===== */
  .empty-cart {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 16px 0;
    gap: 4px;
  }
  .empty-cart-icon {
    font-size: 24px;
    opacity: 0.3;
  }
  .empty-cart-text {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-dim);
  }

  /* ===== Celebration State ===== */
  .celebration-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(10,10,14,0.92);
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    border-radius: 44px;
  }
  .celebration-overlay.visible {
    opacity: 1;
    pointer-events: auto;
  }
  .celebration-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    transform: scale(0.8);
    transition: transform 0.5s cubic-bezier(0.22, 1, 0.36, 1);
  }
  .celebration-overlay.visible .celebration-content {
    transform: scale(1);
  }
  .celebration-emoji {
    font-size: 72px;
    animation: celebrationBounce 0.6s cubic-bezier(0.22, 1, 0.36, 1) 0.3s both;
  }
  @keyframes celebrationBounce {
    0% { transform: scale(0) rotate(-20deg); }
    60% { transform: scale(1.2) rotate(5deg); }
    100% { transform: scale(1) rotate(0deg); }
  }
  .celebration-title {
    font-size: 28px;
    font-weight: 800;
    color: var(--text-primary);
    letter-spacing: -0.5px;
    opacity: 0;
    animation: fadeInUp 0.5s ease 0.5s forwards;
  }
  .celebration-subtitle {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-dim);
    opacity: 0;
    animation: fadeInUp 0.5s ease 0.7s forwards;
  }
  @keyframes fadeInUp {
    0% { opacity: 0; transform: translateY(10px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .celebration-btn {
    margin-top: 20px;
    padding: 14px 36px;
    background: linear-gradient(135deg, var(--teal), #3a8a92);
    color: white;
    font-size: 16px;
    font-weight: 700;
    font-family: inherit;
    border: none;
    border-radius: 16px;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    opacity: 0;
    animation: fadeInUp 0.5s ease 0.9s forwards;
  }
  .celebration-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 24px rgba(78,157,166,0.4);
  }
  .celebration-btn:active {
    transform: scale(0.97);
  }

  /* ===== Confetti ===== */
  .confetti-container {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    z-index: 201;
    border-radius: 44px;
  }
  .confetti-piece {
    position: absolute;
    width: 8px;
    height: 8px;
    opacity: 0;
  }
  .confetti-piece.active {
    animation: confettiFall var(--fall-duration, 3s) cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
  }
  @keyframes confettiFall {
    0% {
      opacity: 1;
      transform: translate(0, 0) rotate(0deg) scale(1);
    }
    20% {
      opacity: 1;
    }
    100% {
      opacity: 0;
      transform: translate(var(--drift-x, 30px), var(--fall-y, 600px)) rotate(var(--spin, 720deg)) scale(0.3);
    }
  }

  /* ===== Bottom Nav ===== */
  .bottom-nav {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    background: var(--nav-bg);
    backdrop-filter: var(--nav-blur);
    -webkit-backdrop-filter: var(--nav-blur);
    border-top: 1px solid var(--nav-border);
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    padding: 12px 16px 32px;
    z-index: 100;
    transition: background 0.4s ease;
  }
  .nav-item {
    display: flex; flex-direction: column; align-items: center; gap: 5px;
    text-decoration: none; color: var(--text-dim); font-size: 10px; font-weight: 600;
    position: relative; cursor: pointer; min-width: 56px; transition: color 0.2s;
  }
  .nav-item.active { color: var(--teal); }
  .nav-item.active::after {
    content: ''; position: absolute; top: -12px; left: 50%;
    transform: translateX(-50%); width: 24px; height: 3px;
    background: var(--teal); border-radius: 2px;
    box-shadow: 0 0 15px rgba(78,157,166,0.4), 0 0 30px rgba(78,157,166,0.15);
  }
  .nav-item svg { width: 24px; height: 24px; fill: currentColor; }
  .nav-badge {
    position: absolute; top: -4px; right: 4px;
    width: 18px; height: 18px; background: var(--orange);
    color: #fff; font-size: 10px; font-weight: 700;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 12px rgba(232,146,58,0.5);
  }
</style>
</head>
<body>

<div class="phone-frame">
  <div class="screen">
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-time">9:41</div>
      <div class="status-icons">
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle theme"></button>
        <svg viewBox="0 0 16 16"><path d="M1.5 4.5C4 2 7.5 1 8 1s4 1 6.5 3.5l-1.2 1.2C11.2 3.6 9 2.5 8 2.5S4.8 3.6 2.7 5.7L1.5 4.5zM4 7.3C5.3 6 6.8 5.2 8 5.2s2.7.8 4 2.1L10.8 8.5C9.8 7.5 9 7 8 7s-1.8.5-2.8 1.5L4 7.3zM6.5 10c.8-.8 1.2-1 1.5-1s.7.2 1.5 1L8 11.5 6.5 10z"/></svg>
        <svg viewBox="0 0 16 16"><path d="M1 4h2v8H1V4zm3.5 2h2v6h-2V6zM8 3h2v9H8V3zm3.5 1h2v8h-2V4z"/></svg>
        <svg viewBox="0 0 24 14"><rect x="0.5" y="0.5" width="20" height="13" rx="2.5" stroke="white" stroke-opacity="0.35" fill="none"/><path opacity="0.4" d="M22 5v4a2 2 0 000-4z" fill="white"/><rect x="2" y="2" width="15" height="9" rx="1.5" fill="white"/></svg>
      </div>
    </div>

    <!-- Header -->
    <div class="header">
      <div class="header-top">
        <a class="nav-back" href="#">
          <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          Listen
        </a>
        <h1 class="header-title">REWE Wocheneinkauf</h1>
      </div>
      <p class="header-subtitle">Einkaufsmodus</p>
    </div>

    <!-- Split View -->
    <div class="split-view">

      <!-- Top: Noch einkaufen -->
      <div class="section-top">
        <div class="section-header">
          <div class="section-title">
            Noch einkaufen
            <span class="section-count" id="todoCount">10</span>
          </div>
        </div>
        <div class="top-grid-wrapper">
          <div class="top-grid" id="topGrid"></div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-section">
        <div class="progress-bar-track">
          <div class="progress-bar-fill" id="progressFill"></div>
        </div>
        <div class="progress-label" id="progressLabel">0 von 10 erledigt</div>
      </div>

      <!-- Bottom: Im Wagen -->
      <div class="section-bottom" id="sectionBottom">
        <div class="section-header">
          <div class="section-title">
            Im Wagen
            <span class="cart-count" id="cartCount">0</span>
          </div>
        </div>
        <div class="bottom-grid-wrapper">
          <div class="bottom-grid" id="bottomGrid">
            <div class="empty-cart">
              <div class="empty-cart-icon">ðŸ›’</div>
              <div class="empty-cart-text">Noch leer</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Celebration Overlay -->
  <div class="celebration-overlay" id="celebrationOverlay">
    <div class="celebration-content">
      <div class="celebration-emoji">ðŸŽ‰</div>
      <div class="celebration-title">Alles eingekauft!</div>
      <div class="celebration-subtitle">Alle 10 Artikel im Wagen</div>
      <button class="celebration-btn" onclick="resetShopping()">Neuer Einkauf</button>
    </div>
  </div>

  <!-- Confetti Container -->
  <div class="confetti-container" id="confettiContainer"></div>

  <!-- Bottom Nav -->
  <div class="bottom-nav">
    <a class="nav-item active" href="#">
      <svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
      <span>Listen</span>
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
      <span>Planen</span>
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24"><path d="M8.1 13.34l2.83-2.83L3.91 3.5a4.008 4.008 0 000 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z"/></svg>
      <span>Rezepte</span>
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
      <span>Aktivit&auml;t</span>
      <div class="nav-badge">3</div>
    </a>
  </div>
</div>

<script>
  // ===== Theme Toggle =====
  const MOON_SVG = '<svg viewBox="0 0 24 24" fill="white"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>';
  const SUN_SVG = '<svg viewBox="0 0 24 24" fill="white"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>';

  function getTheme() {
    return localStorage.getItem('shopzebra_theme') || 'dark';
  }
  function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('shopzebra_theme', theme);
    updateToggleIcon(theme);
  }
  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme') || 'dark';
    applyTheme(current === 'dark' ? 'glass' : 'dark');
  }
  function updateToggleIcon(theme) {
    const btn = document.getElementById('themeToggle');
    if (btn) btn.innerHTML = theme === 'dark' ? MOON_SVG : SUN_SVG;
  }

  // ===== Shopping Items =====
  const SHOPPING_ITEMS = [
    { id: 'aepfel',   emoji: '\u{1F34E}', name: 'Ã„pfel',   qty: '2kg' },
    { id: 'milch',    emoji: '\u{1F95B}', name: 'Milch',    qty: '2L' },
    { id: 'brot',     emoji: '\u{1F35E}', name: 'Brot',     qty: '1' },
    { id: 'nudeln',   emoji: '\u{1F35D}', name: 'Nudeln',   qty: '2x' },
    { id: 'tomaten',  emoji: '\u{1F345}', name: 'Tomaten',  qty: '1kg' },
    { id: 'butter',   emoji: '\u{1F9C8}', name: 'Butter',   qty: '1' },
    { id: 'kaese',    emoji: '\u{1F9C0}', name: 'KÃ¤se',     qty: '1' },
    { id: 'eier',     emoji: '\u{1F95A}', name: 'Eier',     qty: '10' },
    { id: 'bananen',  emoji: '\u{1F34C}', name: 'Bananen',  qty: '6' },
    { id: 'joghurt',  emoji: '\u{1F963}', name: 'Joghurt',  qty: '4x' },
  ];

  const TOTAL = SHOPPING_ITEMS.length;

  // State: track which items are in the cart
  const inCart = new Set();

  // Prevent double-tap during animations
  let animating = false;

  function formatQtyLabel(qty) {
    return 'x' + qty;
  }

  function renderTopGrid() {
    const grid = document.getElementById('topGrid');
    const todoItems = SHOPPING_ITEMS.filter(function(item) { return !inCart.has(item.id); });

    if (todoItems.length === 0) {
      grid.innerHTML = '';
      return;
    }

    grid.innerHTML = todoItems.map(function(item) {
      return '<div class="top-tile" data-id="' + item.id + '" onclick="checkOff(\'' + item.id + '\')">' +
        '<span class="tile-qty">' + formatQtyLabel(item.qty) + '</span>' +
        '<span class="tile-emoji">' + item.emoji + '</span>' +
        '<span class="tile-name">' + item.name + '</span>' +
      '</div>';
    }).join('');
  }

  function renderBottomGrid() {
    const grid = document.getElementById('bottomGrid');
    const cartItems = SHOPPING_ITEMS.filter(function(item) { return inCart.has(item.id); });
    const section = document.getElementById('sectionBottom');

    if (cartItems.length === 0) {
      section.classList.remove('has-items');
      grid.innerHTML = '<div class="empty-cart">' +
        '<div class="empty-cart-icon">\u{1F6D2}</div>' +
        '<div class="empty-cart-text">Noch leer</div>' +
      '</div>';
      return;
    }

    section.classList.add('has-items');
    grid.innerHTML = cartItems.map(function(item) {
      return '<div class="bottom-tile" data-id="' + item.id + '" onclick="undoCheckOff(\'' + item.id + '\')">' +
        '<span class="tile-qty">' + formatQtyLabel(item.qty) + '</span>' +
        '<span class="tile-emoji">' + item.emoji + '</span>' +
        '<span class="tile-name">' + item.name + '</span>' +
      '</div>';
    }).join('');
  }

  function updateCounts() {
    const done = inCart.size;
    const remaining = TOTAL - done;

    document.getElementById('todoCount').textContent = remaining;
    document.getElementById('cartCount').textContent = done;

    const pct = (done / TOTAL) * 100;
    const fill = document.getElementById('progressFill');
    fill.style.width = pct + '%';

    if (done > 0 && done < TOTAL) {
      fill.classList.add('active');
    } else {
      fill.classList.remove('active');
    }

    document.getElementById('progressLabel').textContent = done + ' von ' + TOTAL + ' erledigt';

    // Update celebration subtitle
    const sub = document.querySelector('.celebration-subtitle');
    if (sub) sub.textContent = 'Alle ' + TOTAL + ' Artikel im Wagen';
  }

  function checkOff(itemId) {
    if (animating || inCart.has(itemId)) return;
    animating = true;

    const tile = document.querySelector('.top-tile[data-id="' + itemId + '"]');
    if (!tile) { animating = false; return; }

    // Add check-off animation to top tile
    tile.classList.add('checking-off');

    // Haptic feedback (if supported)
    if (navigator.vibrate) navigator.vibrate(15);

    setTimeout(function() {
      inCart.add(itemId);
      renderTopGrid();
      renderBottomGrid();
      updateCounts();

      // Animate the newly arrived bottom tile
      const newTile = document.querySelector('.bottom-tile[data-id="' + itemId + '"]');
      if (newTile) {
        newTile.classList.add('arriving');
        newTile.addEventListener('animationend', function() {
          newTile.classList.remove('arriving');
        }, { once: true });
      }

      animating = false;

      // Check for celebration
      if (inCart.size === TOTAL) {
        setTimeout(showCelebration, 300);
      }
    }, 400);
  }

  function undoCheckOff(itemId) {
    if (animating || !inCart.has(itemId)) return;
    animating = true;

    const tile = document.querySelector('.bottom-tile[data-id="' + itemId + '"]');
    if (!tile) { animating = false; return; }

    tile.classList.add('returning');

    if (navigator.vibrate) navigator.vibrate(10);

    setTimeout(function() {
      inCart.delete(itemId);
      renderTopGrid();
      renderBottomGrid();
      updateCounts();
      animating = false;
    }, 300);
  }

  // ===== Celebration =====
  function showCelebration() {
    const overlay = document.getElementById('celebrationOverlay');
    overlay.classList.add('visible');
    launchConfetti();
  }

  function hideCelebration() {
    const overlay = document.getElementById('celebrationOverlay');
    overlay.classList.remove('visible');
  }

  function resetShopping() {
    hideCelebration();
    inCart.clear();
    renderTopGrid();
    renderBottomGrid();
    updateCounts();
  }

  // ===== Confetti =====
  function launchConfetti() {
    const container = document.getElementById('confettiContainer');
    container.innerHTML = '';

    const colors = ['#E8923A', '#4E9DA6', '#6BBF6B', '#E07B7B', '#A07BCC', '#E8C44A', '#5BA8D5', '#EC4899'];
    const shapes = ['circle', 'square', 'rect'];
    const pieceCount = 60;

    for (let i = 0; i < pieceCount; i++) {
      const piece = document.createElement('div');
      piece.className = 'confetti-piece';

      const color = colors[Math.floor(Math.random() * colors.length)];
      const shape = shapes[Math.floor(Math.random() * shapes.length)];
      const startX = Math.random() * 390;
      const startY = -10;
      const driftX = (Math.random() - 0.5) * 200;
      const fallY = 500 + Math.random() * 400;
      const spin = (Math.random() - 0.5) * 1440;
      const duration = 2 + Math.random() * 2;
      const delay = Math.random() * 0.8;

      piece.style.left = startX + 'px';
      piece.style.top = startY + 'px';
      piece.style.background = color;
      piece.style.setProperty('--drift-x', driftX + 'px');
      piece.style.setProperty('--fall-y', fallY + 'px');
      piece.style.setProperty('--spin', spin + 'deg');
      piece.style.setProperty('--fall-duration', duration + 's');

      if (shape === 'circle') {
        piece.style.borderRadius = '50%';
        piece.style.width = (6 + Math.random() * 6) + 'px';
        piece.style.height = piece.style.width;
      } else if (shape === 'rect') {
        piece.style.width = (4 + Math.random() * 4) + 'px';
        piece.style.height = (8 + Math.random() * 10) + 'px';
        piece.style.borderRadius = '1px';
      } else {
        const size = (5 + Math.random() * 6) + 'px';
        piece.style.width = size;
        piece.style.height = size;
        piece.style.borderRadius = '1px';
      }

      container.appendChild(piece);

      // Trigger animation with delay
      setTimeout(function() {
        piece.classList.add('active');
      }, delay * 1000);
    }

    // Clean up confetti after animations
    setTimeout(function() {
      container.innerHTML = '';
    }, 5000);
  }

  // ===== Init =====
  applyTheme(getTheme());
  renderTopGrid();
  renderBottomGrid();
  updateCounts();
</script>

</body>
</html>
