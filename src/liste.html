<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShopZebra - Einkaufsliste</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  /* ===== Theme Variables ===== */
  [data-theme="dark"] {
    --body-bg: #0a0a0e;
    --screen-bg: #121216;
    --screen-gradient: none;
    --surface: rgba(255,255,255,0.04);
    --surface-hover: rgba(255,255,255,0.06);
    --surface-border: rgba(255,255,255,0.06);
    --teal: #4E9DA6;
    --orange: #E8923A;
    --text-primary: #ffffff;
    --text-secondary: rgba(255,255,255,0.5);
    --text-dim: rgba(255,255,255,0.35);
    --card-bg: rgba(255,255,255,0.03);
    --card-border: rgba(255,255,255,0.06);
    --card-blur: 0px;
    --chip-bg: rgba(255,255,255,0.06);
    --chip-border: rgba(255,255,255,0.08);
    --chip-blur: 0px;
    --frame-shadow: 0 0 60px rgba(0,0,0,0.5), 0 0 120px rgba(78,157,166,0.05);
    --frame-border: 1px solid rgba(255,255,255,0.08);
    --frame-outline: none;
    --icon-radius: 50%;
    --nav-bg: rgba(18,18,22,0.85);
    --nav-blur: blur(20px);
    --nav-border: rgba(255,255,255,0.06);
    --logo-filter: drop-shadow(0 0 10px rgba(78,157,166,0.3));
    --warenkorb-border: none;
    --warenkorb-before: linear-gradient(135deg, var(--teal), var(--orange));
    --warenkorb-before-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    --warenkorb-before-top: 0;
    --warenkorb-before-right: 0;
    --warenkorb-before-width: auto;
    --warenkorb-before-height: auto;
    --warenkorb-before-radius: 22px;
    --warenkorb-before-inset: 0;
    --warenkorb-before-padding: 1px;
    --badge-bg: var(--orange);
    --badge-color: #fff;
    --badge-border: none;
    --badge-shadow: 0 0 8px rgba(232,146,58,0.3);
    --cat-card-before-opacity: 0;
    --green-bg: rgba(107,191,107,0.12);
    --green-glow: 0 0 20px rgba(107,191,107,0.3);
    --blue-bg: rgba(91,168,213,0.12);
    --blue-glow: 0 0 20px rgba(91,168,213,0.3);
    --yellow-bg: rgba(232,196,74,0.12);
    --yellow-glow: 0 0 20px rgba(232,196,74,0.3);
    --red-bg: rgba(224,123,123,0.12);
    --red-glow: 0 0 20px rgba(224,123,123,0.3);
    --purple-bg: rgba(160,123,204,0.12);
    --purple-glow: 0 0 20px rgba(160,123,204,0.3);
    --cyan-bg: rgba(78,200,220,0.12);
    --cyan-glow: 0 0 20px rgba(78,200,220,0.3);
    --chevron-green: #6BBF6B;
    --chevron-blue: #5BA8D5;
    --chevron-yellow: #E8C44A;
    --chevron-red: #E07B7B;
    --chevron-purple: #A07BCC;
    --chevron-cyan: #4EC8DC;
    --progress-bg: rgba(255,255,255,0.06);
    --progress-fill: linear-gradient(90deg, var(--teal), #6BC5A0);
    --erledigt-bg: rgba(255,255,255,0.02);
    --erledigt-border: rgba(255,255,255,0.04);
    --celebration-glow: rgba(78,157,166,0.15);
  }

  [data-theme="glass"] {
    --body-bg: #1a1a2e;
    --screen-bg: #0a0a12;
    --screen-gradient:
      radial-gradient(ellipse at 20% 80%, rgba(120, 50, 180, 0.35) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, rgba(50, 120, 180, 0.3) 0%, transparent 60%),
      radial-gradient(ellipse at 50% 50%, rgba(180, 50, 120, 0.2) 0%, transparent 60%),
      radial-gradient(ellipse at 10% 20%, rgba(139, 92, 246, 0.2) 0%, transparent 50%),
      radial-gradient(ellipse at 90% 80%, rgba(59, 130, 246, 0.18) 0%, transparent 50%);
    --surface: rgba(255,255,255,0.06);
    --surface-hover: rgba(255,255,255,0.09);
    --surface-border: rgba(255,255,255,0.1);
    --teal: #4E9DA6;
    --orange: #E8923A;
    --text-primary: #ffffff;
    --text-secondary: rgba(255,255,255,0.5);
    --text-dim: rgba(255,255,255,0.35);
    --card-bg: rgba(255,255,255,0.06);
    --card-border: rgba(255,255,255,0.1);
    --card-blur: blur(20px);
    --chip-bg: rgba(255,255,255,0.06);
    --chip-border: rgba(255,255,255,0.08);
    --chip-blur: blur(12px);
    --frame-shadow: 0 0 0 2px rgba(255,255,255,0.08), 0 40px 80px rgba(0,0,0,0.6), 0 0 120px rgba(139,92,246,0.15), 0 0 80px rgba(236,72,153,0.1);
    --frame-border: none;
    --frame-outline: none;
    --icon-radius: 14px;
    --nav-bg: rgba(10,10,18,0.7);
    --nav-blur: blur(24px);
    --nav-border: rgba(255,255,255,0.06);
    --logo-filter: drop-shadow(0 0 12px rgba(139,92,246,0.4)) drop-shadow(0 0 24px rgba(236,72,153,0.2));
    --warenkorb-border: 1px solid rgba(255,255,255,0.1);
    --warenkorb-before: radial-gradient(circle, rgba(232,146,58,0.1) 0%, transparent 70%);
    --warenkorb-before-mask: none;
    --warenkorb-before-top: -40%;
    --warenkorb-before-right: -20%;
    --warenkorb-before-width: 200px;
    --warenkorb-before-height: 200px;
    --warenkorb-before-radius: 50%;
    --warenkorb-before-inset: auto;
    --warenkorb-before-padding: 0;
    --badge-bg: rgba(232,146,58,0.2);
    --badge-color: #E8923A;
    --badge-border: 1px solid rgba(232,146,58,0.25);
    --badge-shadow: none;
    --cat-card-before-opacity: 1;
    --green-bg: rgba(80,180,80,0.15);
    --green-glow: 0 0 20px rgba(80,180,80,0.2);
    --blue-bg: rgba(59,130,246,0.15);
    --blue-glow: 0 0 20px rgba(59,130,246,0.2);
    --yellow-bg: rgba(220,180,60,0.15);
    --yellow-glow: 0 0 20px rgba(220,180,60,0.2);
    --red-bg: rgba(236,72,153,0.15);
    --red-glow: 0 0 20px rgba(236,72,153,0.2);
    --purple-bg: rgba(139,92,246,0.15);
    --purple-glow: 0 0 20px rgba(139,92,246,0.2);
    --cyan-bg: rgba(78,200,220,0.15);
    --cyan-glow: 0 0 20px rgba(78,200,220,0.2);
    --chevron-green: rgba(255,255,255,0.25);
    --chevron-blue: rgba(255,255,255,0.25);
    --chevron-yellow: rgba(255,255,255,0.25);
    --chevron-red: rgba(255,255,255,0.25);
    --chevron-purple: rgba(255,255,255,0.25);
    --chevron-cyan: rgba(255,255,255,0.25);
    --progress-bg: rgba(255,255,255,0.08);
    --progress-fill: linear-gradient(90deg, var(--teal), #6BC5A0);
    --erledigt-bg: rgba(255,255,255,0.03);
    --erledigt-border: rgba(255,255,255,0.06);
    --celebration-glow: rgba(139,92,246,0.15);
  }

  /* ===== Reset ===== */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  /* ===== Transitions ===== */
  body,
  .phone-frame,
  .screen,
  .warenkorb-card,
  .category-card,
  .category-icon,
  .warenkorb-tile,
  .bottom-nav,
  .status-bar,
  .warenkorb-count {
    transition: background 0.4s ease, background-color 0.4s ease, border-color 0.3s ease, box-shadow 0.4s ease, border-radius 0.3s ease;
  }

  /* ===== Body ===== */
  body {
    background: var(--body-bg);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
    color: var(--text-primary);
  }

  /* ===== Phone Frame ===== */
  .phone-frame {
    width: 390px;
    height: 844px;
    background: var(--screen-bg);
    border-radius: 44px;
    overflow: hidden;
    position: relative;
    border: var(--frame-border);
    box-shadow: var(--frame-shadow);
  }

  /* ===== Screen ===== */
  .screen {
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    padding-bottom: 100px;
    scrollbar-width: none;
    background-color: var(--screen-bg);
    background-image: var(--screen-gradient);
  }
  .screen::-webkit-scrollbar { display: none; }

  /* ===== Status Bar ===== */
  .status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 28px 8px;
    position: sticky;
    top: 0;
    z-index: 50;
    background: var(--screen-bg);
  }
  .status-time {
    font-size: 15px;
    font-weight: 700;
    letter-spacing: 0.5px;
    color: var(--text-primary);
  }
  .status-icons {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .status-icons svg {
    width: 16px;
    height: 16px;
    fill: white;
  }

  /* ===== Theme Toggle ===== */
  .theme-toggle {
    width: 20px;
    height: 20px;
    background: transparent;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.5;
    transition: opacity 0.2s ease;
    padding: 0;
    margin: 0 6px;
  }
  .theme-toggle:hover { opacity: 0.85; }
  .theme-toggle svg {
    width: 16px;
    height: 16px;
    fill: white;
  }

  /* ===== Header ===== */
  .header {
    padding: 8px 20px 16px;
  }
  .header-top {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 4px;
  }
  .header-title {
    font-size: 24px;
    font-weight: 800;
    color: var(--text-primary);
    letter-spacing: -0.3px;
  }
  .header-subtitle {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-dim);
    padding-left: 48px;
  }

  /* ===== Back Link ===== */
  .nav-back {
    display: flex;
    align-items: center;
    gap: 6px;
    background: none;
    border: none;
    color: var(--teal);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    font-family: inherit;
    text-decoration: none;
    flex-shrink: 0;
  }
  .nav-back svg { width: 20px; height: 20px; fill: var(--teal); }

  /* ===== Warenkorb Card ===== */
  .warenkorb-section {
    padding: 0 20px;
    margin-bottom: 24px;
  }
  .warenkorb-card {
    position: relative;
    border-radius: 22px;
    padding: 18px;
    background: var(--card-bg);
    border: var(--warenkorb-border);
    overflow: hidden;
    backdrop-filter: var(--card-blur);
    -webkit-backdrop-filter: var(--card-blur);
  }
  .warenkorb-card::before {
    content: '';
    position: absolute;
    inset: var(--warenkorb-before-inset);
    top: var(--warenkorb-before-top);
    right: var(--warenkorb-before-right);
    width: var(--warenkorb-before-width);
    height: var(--warenkorb-before-height);
    border-radius: var(--warenkorb-before-radius);
    padding: var(--warenkorb-before-padding);
    background: var(--warenkorb-before);
    -webkit-mask: var(--warenkorb-before-mask);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
    transition: opacity 0.4s ease;
  }
  .warenkorb-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
    position: relative;
    z-index: 1;
  }
  .warenkorb-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--text-primary);
  }
  .warenkorb-count {
    background: var(--badge-bg);
    color: var(--badge-color);
    font-size: 12px;
    font-weight: 700;
    padding: 4px 12px;
    border-radius: 20px;
    border: var(--badge-border);
    box-shadow: var(--badge-shadow);
  }
  [data-theme="dark"] .warenkorb-count {
    animation: pulseOrange 2s ease-in-out infinite;
  }
  [data-theme="glass"] .warenkorb-count {
    animation: none;
  }
  @keyframes pulseOrange {
    0%, 100% { box-shadow: 0 0 8px rgba(232,146,58,0.3); }
    50% { box-shadow: 0 0 18px rgba(232,146,58,0.6), 0 0 30px rgba(232,146,58,0.2); }
  }

  /* ===== Progress Bar ===== */
  .progress-section {
    position: relative;
    z-index: 1;
    margin-bottom: 16px;
  }
  .progress-label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .progress-text {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
  }
  .progress-percent {
    font-size: 12px;
    font-weight: 700;
    color: var(--teal);
  }
  .progress-bar {
    width: 100%;
    height: 6px;
    background: var(--progress-bg);
    border-radius: 3px;
    overflow: hidden;
    position: relative;
  }
  .progress-fill {
    height: 100%;
    background: var(--progress-fill);
    border-radius: 3px;
    transition: width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    position: relative;
  }
  .progress-fill::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 20px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3));
    border-radius: 0 3px 3px 0;
  }

  /* ===== Warenkorb Grid ===== */
  .warenkorb-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    position: relative;
    z-index: 1;
  }

  .warenkorb-tile {
    position: relative;
    padding: 8px 4px;
    border-radius: 14px;
    background: var(--surface);
    border: 1px solid var(--surface-border);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    cursor: pointer;
    backdrop-filter: var(--chip-blur);
    -webkit-backdrop-filter: var(--chip-blur);
    transition: all 0.25s ease;
    user-select: none;
    -webkit-user-select: none;
    min-height: 68px;
  }
  .warenkorb-tile:hover {
    background: var(--surface-hover);
    box-shadow: 0 0 10px rgba(78,157,166,0.15);
  }
  .warenkorb-tile:active {
    transform: scale(0.95);
  }

  .warenkorb-tile.checking {
    animation: tileCheckOff 0.4s ease forwards;
  }
  @keyframes tileCheckOff {
    0% { transform: scale(1); opacity: 1; }
    30% { transform: scale(0.85); opacity: 0.7; }
    60% { transform: scale(0.9); opacity: 0.4; }
    100% { transform: scale(0.8); opacity: 0; max-height: 0; padding: 0; margin: 0; overflow: hidden; }
  }

  .warenkorb-tile.restoring {
    animation: tileRestore 0.35s ease forwards;
  }
  @keyframes tileRestore {
    0% { transform: scale(0.8); opacity: 0; }
    60% { transform: scale(1.05); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
  }

  .tile-qty {
    position: absolute;
    top: 4px;
    right: 4px;
    font-size: 9px;
    font-weight: 700;
    color: var(--teal);
    background: rgba(78,157,166,0.15);
    padding: 1px 5px;
    border-radius: 8px;
    line-height: 1.2;
  }

  .tile-emoji {
    font-size: 22px;
    line-height: 1;
  }

  .tile-name {
    font-size: 9px;
    font-weight: 500;
    color: var(--text-secondary);
    text-align: center;
    max-width: 100%;
    padding: 0 4px;
    line-height: 1.2;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .warenkorb-empty {
    color: var(--text-dim);
    font-size: 13px;
    font-weight: 500;
    text-align: center;
    padding: 12px 0;
    grid-column: 1 / -1;
  }

  /* ===== Erledigt Section ===== */
  .erledigt-section {
    position: relative;
    z-index: 1;
    margin-top: 14px;
  }
  .erledigt-divider {
    width: 100%;
    height: 1px;
    background: var(--erledigt-border);
    margin-bottom: 12px;
  }
  .erledigt-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    padding: 8px 0;
    user-select: none;
    -webkit-user-select: none;
  }
  .erledigt-chevron {
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.25s ease;
  }
  .erledigt-chevron svg {
    width: 12px;
    height: 12px;
  }
  .erledigt-toggle.expanded .erledigt-chevron {
    transform: rotate(90deg);
  }
  .erledigt-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-dim);
  }
  .erledigt-count-badge {
    font-size: 11px;
    font-weight: 700;
    color: var(--teal);
    background: rgba(78,157,166,0.12);
    padding: 2px 8px;
    border-radius: 10px;
  }

  .erledigt-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                opacity 0.3s ease,
                margin-top 0.3s ease;
    margin-top: 0;
  }
  .erledigt-grid.expanded {
    max-height: 600px;
    opacity: 1;
    margin-top: 8px;
  }

  .erledigt-tile {
    position: relative;
    padding: 8px 4px;
    border-radius: 14px;
    background: var(--erledigt-bg);
    border: 1px solid var(--erledigt-border);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    cursor: pointer;
    opacity: 0.45;
    transition: all 0.25s ease;
    user-select: none;
    -webkit-user-select: none;
    min-height: 68px;
  }
  .erledigt-tile:hover {
    opacity: 0.65;
    background: var(--surface);
  }
  .erledigt-tile:active {
    transform: scale(0.95);
  }
  .erledigt-tile .tile-emoji {
    font-size: 20px;
    filter: grayscale(30%);
  }
  .erledigt-tile .tile-name {
    text-decoration: line-through;
    text-decoration-color: var(--text-dim);
    color: var(--text-dim);
    font-size: 9px;
  }
  .erledigt-tile .tile-qty {
    opacity: 0.5;
  }

  .erledigt-tile.incoming {
    animation: erledigtIncoming 0.4s ease forwards;
  }
  @keyframes erledigtIncoming {
    0% { transform: scale(0.5) translateY(-20px); opacity: 0; }
    60% { transform: scale(1.05) translateY(0); opacity: 0.5; }
    100% { transform: scale(1) translateY(0); opacity: 0.45; }
  }

  /* ===== Celebration State ===== */
  .celebration-container {
    position: relative;
    z-index: 1;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 32px 16px;
    text-align: center;
  }
  .celebration-container.visible {
    display: flex;
    animation: celebrationIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }
  @keyframes celebrationIn {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
  }
  .celebration-icon {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: rgba(78,157,166,0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
    box-shadow: 0 0 40px var(--celebration-glow), 0 0 80px var(--celebration-glow);
    animation: celebrationPulse 2s ease-in-out infinite;
  }
  @keyframes celebrationPulse {
    0%, 100% { box-shadow: 0 0 40px var(--celebration-glow); transform: scale(1); }
    50% { box-shadow: 0 0 60px var(--celebration-glow), 0 0 100px var(--celebration-glow); transform: scale(1.05); }
  }
  .celebration-icon svg {
    width: 36px;
    height: 36px;
    fill: var(--teal);
  }
  .celebration-title {
    font-size: 20px;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 6px;
    letter-spacing: -0.3px;
  }
  .celebration-subtitle {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-dim);
    margin-bottom: 24px;
  }
  .celebration-btn {
    background: linear-gradient(135deg, var(--teal), #3D8B94);
    color: #fff;
    border: none;
    border-radius: 16px;
    padding: 14px 32px;
    font-size: 15px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.25s ease;
    letter-spacing: 0.2px;
  }
  .celebration-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(78,157,166,0.3);
  }
  .celebration-btn:active {
    transform: scale(0.97);
  }

  /* ===== Confetti ===== */
  .confetti-container {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    z-index: 2;
  }
  .confetti {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 2px;
    top: -10px;
    animation: confettiFall linear forwards;
  }
  @keyframes confettiFall {
    0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
    80% { opacity: 1; }
    100% { transform: translateY(300px) rotate(720deg) scale(0.5); opacity: 0; }
  }

  /* ===== Category Cards ===== */
  .categories-section {
    padding: 0 20px;
  }
  .categories-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1.2px;
    margin-bottom: 14px;
  }
  .category-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .category-card {
    display: flex;
    align-items: center;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 22px;
    padding: 18px;
    text-decoration: none;
    color: inherit;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    backdrop-filter: var(--card-blur);
    -webkit-backdrop-filter: var(--card-blur);
    transition: all 0.25s ease;
  }
  .category-card:hover {
    background: var(--surface-hover);
    transform: translateY(-1px);
  }
  .category-card:active {
    transform: scale(0.98);
  }

  .category-card::before {
    content: '';
    position: absolute;
    top: -30%;
    left: -20%;
    width: 200px;
    height: 200px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
    opacity: var(--cat-card-before-opacity);
    transition: opacity 0.4s ease;
  }
  .category-card[data-cat="obst-gemuese"]::before {
    background: radial-gradient(circle, rgba(80,180,80,0.15) 0%, transparent 70%);
  }
  .category-card[data-cat="milch-kaese"]::before {
    background: radial-gradient(circle, rgba(59,130,246,0.15) 0%, transparent 70%);
  }
  .category-card[data-cat="brot-gebaeck"]::before {
    background: radial-gradient(circle, rgba(220,180,60,0.15) 0%, transparent 70%);
  }
  .category-card[data-cat="fleisch-fisch"]::before {
    background: radial-gradient(circle, rgba(236,72,153,0.15) 0%, transparent 70%);
  }
  .category-card[data-cat="zutaten-gewuerze"]::before {
    background: radial-gradient(circle, rgba(139,92,246,0.15) 0%, transparent 70%);
  }
  .category-card[data-cat="drogerie-haushalt"]::before {
    background: radial-gradient(circle, rgba(78,200,220,0.15) 0%, transparent 70%);
  }

  .category-icon {
    width: 52px;
    height: 52px;
    border-radius: var(--icon-radius);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
    margin-right: 16px;
    position: relative;
    z-index: 1;
  }
  .category-icon.green { background: var(--green-bg); box-shadow: var(--green-glow); }
  .category-icon.blue { background: var(--blue-bg); box-shadow: var(--blue-glow); }
  .category-icon.yellow { background: var(--yellow-bg); box-shadow: var(--yellow-glow); }
  .category-icon.red { background: var(--red-bg); box-shadow: var(--red-glow); }
  .category-icon.purple { background: var(--purple-bg); box-shadow: var(--purple-glow); }
  .category-icon.cyan { background: var(--cyan-bg); box-shadow: var(--cyan-glow); }

  .category-info {
    flex: 1;
    min-width: 0;
    position: relative;
    z-index: 1;
  }
  .category-name {
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 2px;
  }
  .category-count {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-dim);
  }

  .category-right {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
    position: relative;
    z-index: 1;
  }
  .category-badge {
    background: rgba(78,157,166,0.15);
    color: var(--teal);
    font-size: 11px;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 12px;
    display: none;
  }
  .category-badge.visible { display: block; }
  .category-chevron {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.4;
  }
  .category-chevron svg {
    width: 14px;
    height: 14px;
  }

  /* ===== Bottom Nav ===== */
  .bottom-nav {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    background: var(--nav-bg);
    backdrop-filter: var(--nav-blur);
    -webkit-backdrop-filter: var(--nav-blur);
    border-top: 1px solid var(--nav-border);
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    padding: 12px 16px 32px;
    z-index: 100;
  }
  .nav-item {
    display: flex; flex-direction: column; align-items: center; gap: 5px;
    text-decoration: none; color: var(--text-dim); font-size: 10px; font-weight: 600;
    position: relative; cursor: pointer; min-width: 56px; transition: color 0.2s;
  }
  .nav-item.active { color: var(--teal); }
  .nav-item.active::after {
    content: ''; position: absolute; top: -12px; left: 50%;
    transform: translateX(-50%); width: 24px; height: 3px;
    background: var(--teal); border-radius: 2px;
    box-shadow: 0 0 15px rgba(78,157,166,0.4), 0 0 30px rgba(78,157,166,0.15);
  }
  .nav-item svg { width: 24px; height: 24px; fill: currentColor; }
  .nav-badge {
    position: absolute; top: -4px; right: 4px;
    width: 18px; height: 18px; background: var(--orange);
    color: #fff; font-size: 10px; font-weight: 700;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 12px rgba(232,146,58,0.5);
  }
</style>
</head>
<body>

<div class="phone-frame">
  <div class="screen">
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-time">9:41</div>
      <div class="status-icons">
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle theme"></button>
        <svg viewBox="0 0 16 16"><path d="M1.5 4.5C4 2 7.5 1 8 1s4 1 6.5 3.5l-1.2 1.2C11.2 3.6 9 2.5 8 2.5S4.8 3.6 2.7 5.7L1.5 4.5zM4 7.3C5.3 6 6.8 5.2 8 5.2s2.7.8 4 2.1L10.8 8.5C9.8 7.5 9 7 8 7s-1.8.5-2.8 1.5L4 7.3zM6.5 10c.8-.8 1.2-1 1.5-1s.7.2 1.5 1L8 11.5 6.5 10z"/></svg>
        <svg viewBox="0 0 16 16"><path d="M1 4h2v8H1V4zm3.5 2h2v6h-2V6zM8 3h2v9H8V3zm3.5 1h2v8h-2V4z"/></svg>
        <svg viewBox="0 0 24 14"><rect x="0.5" y="0.5" width="20" height="13" rx="2.5" stroke="white" stroke-opacity="0.35" fill="none"/><path opacity="0.4" d="M22 5v4a2 2 0 000-4z" fill="white"/><rect x="2" y="2" width="15" height="9" rx="1.5" fill="white"/></svg>
      </div>
    </div>

    <!-- Header -->
    <div class="header">
      <div class="header-top">
        <a class="nav-back" href="listen.html">
          <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          Listen
        </a>
        <h1 class="header-title">REWE Wocheneinkauf</h1>
      </div>
      <p class="header-subtitle">Familien-Einkauf &middot; 3 Personen</p>
    </div>

    <!-- Warenkorb / Einkaufsliste -->
    <div class="warenkorb-section">
      <div class="warenkorb-card">
        <div class="warenkorb-header">
          <span class="warenkorb-title">Einkaufsliste</span>
          <span class="warenkorb-count" id="warenkorbCount">0 Artikel</span>
        </div>

        <!-- Progress Bar -->
        <div class="progress-section" id="progressSection" style="display: none;">
          <div class="progress-label">
            <span class="progress-text" id="progressText">0 von 0 erledigt</span>
            <span class="progress-percent" id="progressPercent">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
        </div>

        <!-- Active Items Grid -->
        <div class="warenkorb-grid" id="activeGrid"></div>

        <!-- Erledigt Section -->
        <div class="erledigt-section" id="erledigtSection" style="display: none;">
          <div class="erledigt-divider"></div>
          <div class="erledigt-toggle" id="erledigtToggle">
            <div class="erledigt-chevron">
              <svg viewBox="0 0 14 14" fill="none" stroke="var(--text-dim)" stroke-width="2" stroke-linecap="round"><path d="M5 2l5 5-5 5"/></svg>
            </div>
            <span class="erledigt-label">Erledigt</span>
            <span class="erledigt-count-badge" id="erledigtCountBadge">0</span>
          </div>
          <div class="erledigt-grid" id="erledigtGrid"></div>
        </div>

        <!-- Celebration State -->
        <div class="celebration-container" id="celebrationContainer">
          <div class="confetti-container" id="confettiContainer"></div>
          <div class="celebration-icon">
            <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
          </div>
          <div class="celebration-title">Alles eingekauft!</div>
          <div class="celebration-subtitle" id="celebrationSubtitle"></div>
          <button class="celebration-btn" onclick="resetList()">Neuer Einkauf</button>
        </div>
      </div>
    </div>

    <!-- Categories -->
    <div class="categories-section">
      <div class="categories-label">Kategorien</div>
      <div class="category-list" id="categoryList"></div>
    </div>
  </div>

  <!-- Bottom Nav -->
  <div class="bottom-nav">
    <a class="nav-item active" href="listen.html">
      <svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
      <span>Listen</span>
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
      <span>Planen</span>
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24"><path d="M8.1 13.34l2.83-2.83L3.91 3.5a4.008 4.008 0 000 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z"/></svg>
      <span>Rezepte</span>
    </a>
    <a class="nav-item" href="#">
      <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
      <span>Aktivität</span>
      <div class="nav-badge">3</div>
    </a>
  </div>
</div>

<script>
  // ===== Theme Toggle =====
  const MOON_SVG = '<svg viewBox="0 0 24 24" fill="white"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>';
  const SUN_SVG = '<svg viewBox="0 0 24 24" fill="white"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>';

  function getTheme() { return localStorage.getItem('shopzebra_theme') || 'dark'; }
  function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('shopzebra_theme', theme);
    updateToggleIcon(theme);
  }
  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme') || 'dark';
    applyTheme(current === 'dark' ? 'glass' : 'dark');
  }
  function updateToggleIcon(theme) {
    const btn = document.getElementById('themeToggle');
    if (btn) btn.innerHTML = theme === 'dark' ? MOON_SVG : SUN_SVG;
  }

  // ===== List ID from URL =====
  const LIST_ID = new URLSearchParams(window.location.search).get('id') || 'default';

  // ===== Storage Keys (per list) =====
  const STORAGE_KEY = 'shopzebra_items_' + LIST_ID;
  const ERLEDIGT_KEY = 'shopzebra_erledigt_' + LIST_ID;

  // ===== Default Items =====
  const DEFAULT_ITEMS = [
    { id: 'aepfel', emoji: '\u{1F34E}', name: 'Äpfel', qty: 2, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'bananen', emoji: '\u{1F34C}', name: 'Bananen', qty: 6, unit: 'St', cat: 'obst-gemuese' },
    { id: 'tomaten', emoji: '\u{1F345}', name: 'Tomaten', qty: 1, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'kartoffeln', emoji: '\u{1F954}', name: 'Kartoffeln', qty: 2, unit: 'kg', cat: 'obst-gemuese' },
    { id: 'gurke', emoji: '\u{1F952}', name: 'Gurke', qty: 2, unit: 'St', cat: 'obst-gemuese' },
    { id: 'paprika', emoji: '\u{1FAD1}', name: 'Paprika', qty: 3, unit: 'St', cat: 'obst-gemuese' },
    { id: 'zwiebeln', emoji: '\u{1F9C5}', name: 'Zwiebeln', qty: 1, unit: 'Netz', cat: 'obst-gemuese' },
    { id: 'salat', emoji: '\u{1F957}', name: 'Salat', qty: 1, unit: 'Kopf', cat: 'obst-gemuese' },
    { id: 'milch', emoji: '\u{1F95B}', name: 'Milch', qty: 2, unit: 'L', cat: 'milch-kaese' },
    { id: 'gouda', emoji: '\u{1F9C0}', name: 'Gouda', qty: 1, unit: 'Pck', cat: 'milch-kaese' },
    { id: 'jogurt', emoji: '\u{1F963}', name: 'Joghurt', qty: 4, unit: 'St', cat: 'milch-kaese' },
    { id: 'butter', emoji: '\u{1F9C8}', name: 'Butter', qty: 1, unit: 'St', cat: 'milch-kaese' },
    { id: 'brot', emoji: '\u{1F35E}', name: 'Brot', qty: 1, unit: 'Pck', cat: 'brot-gebaeck' },
    { id: 'broetchen', emoji: '\u{1F96F}', name: 'Brötchen', qty: 6, unit: 'St', cat: 'brot-gebaeck' },
    { id: 'hackfleisch', emoji: '\u{1F969}', name: 'Hackfleisch', qty: 1, unit: '500g', cat: 'fleisch-fisch' },
    { id: 'haehnchen', emoji: '\u{1F357}', name: 'Hähnchenbrust', qty: 1, unit: '400g', cat: 'fleisch-fisch' },
    { id: 'lachs', emoji: '\u{1F41F}', name: 'Lachs', qty: 1, unit: '200g', cat: 'fleisch-fisch' },
    { id: 'nudeln', emoji: '\u{1F35D}', name: 'Nudeln', qty: 2, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'reis', emoji: '\u{1F35A}', name: 'Reis', qty: 1, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'speiseoel', emoji: '\u{1FAD2}', name: 'Speiseöl', qty: 1, unit: 'Fl', cat: 'zutaten-gewuerze' },
    { id: 'passierte-tomaten', emoji: '\u{1F96B}', name: 'Passierte Tomaten', qty: 2, unit: 'Pck', cat: 'zutaten-gewuerze' },
    { id: 'sojasauce', emoji: '\u{1F962}', name: 'Sojasauce', qty: 1, unit: 'Fl', cat: 'zutaten-gewuerze' }
  ];

  const CATEGORIES = [
    { id: 'obst-gemuese', name: 'Obst & Gemüse', emoji: '\u{1F34E}', color: 'green', totalProducts: 40 },
    { id: 'milch-kaese', name: 'Milch & Käse', emoji: '\u{1F9C0}', color: 'blue', totalProducts: 13 },
    { id: 'brot-gebaeck', name: 'Brot & Gebäck', emoji: '\u{1F35E}', color: 'yellow', totalProducts: 10 },
    { id: 'fleisch-fisch', name: 'Fleisch & Fisch', emoji: '\u{1F969}', color: 'red', totalProducts: 12 },
    { id: 'zutaten-gewuerze', name: 'Zutaten & Gewürze', emoji: '\u{1F9C2}', color: 'purple', totalProducts: 26 },
    { id: 'drogerie-haushalt', name: 'Drogerie & Haushalt', emoji: '\u{1F9F4}', color: 'cyan', totalProducts: 20 }
  ];

  const CHEVRON_COLORS = {
    green: 'var(--chevron-green)', blue: 'var(--chevron-blue)', yellow: 'var(--chevron-yellow)',
    red: 'var(--chevron-red)', purple: 'var(--chevron-purple)', cyan: 'var(--chevron-cyan)'
  };

  // ===== State =====
  let erledigtExpanded = false;

  function loadItems() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored === null) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_ITEMS));
      return [...DEFAULT_ITEMS];
    }
    try { return JSON.parse(stored); }
    catch (e) { return [...DEFAULT_ITEMS]; }
  }

  function saveItems(items) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
  }

  function loadErledigt() {
    const stored = localStorage.getItem(ERLEDIGT_KEY);
    if (!stored) return [];
    try { return JSON.parse(stored); } catch (e) { return []; }
  }

  function saveErledigt(items) {
    localStorage.setItem(ERLEDIGT_KEY, JSON.stringify(items));
  }

  function formatQty(item) {
    if (['500g', '400g', '200g'].includes(item.unit)) return item.unit;
    if (item.qty === 1 && ['St', 'Kopf', 'Knolle', 'Netz', 'Beutel', 'L', 'Fl', 'Pck'].includes(item.unit)) return '1';
    return String(item.qty);
  }

  // ===== Progress =====
  function updateProgress() {
    const activeItems = loadItems();
    const erledigtItems = loadErledigt();
    const total = activeItems.length + erledigtItems.length;
    const done = erledigtItems.length;
    const pct = total > 0 ? Math.round((done / total) * 100) : 0;
    const progressSection = document.getElementById('progressSection');

    if (total === 0) {
      progressSection.style.display = 'none';
    } else {
      progressSection.style.display = '';
      document.getElementById('progressText').textContent = done + ' von ' + total + ' erledigt';
      document.getElementById('progressPercent').textContent = pct + '%';
      document.getElementById('progressFill').style.width = pct + '%';
    }
    document.getElementById('warenkorbCount').textContent = total + ' Artikel';
  }

  // ===== Active Grid =====
  function renderActiveGrid() {
    const activeItems = loadItems();
    const erledigtItems = loadErledigt();
    const grid = document.getElementById('activeGrid');

    if (activeItems.length === 0 && erledigtItems.length > 0) {
      // All done — celebration
      grid.style.display = 'none';
      document.getElementById('progressSection').style.display = 'none';
      document.getElementById('erledigtSection').style.display = 'none';

      const celebration = document.getElementById('celebrationContainer');
      document.getElementById('celebrationSubtitle').textContent =
        'Alle ' + erledigtItems.length + ' Artikel erledigt';
      celebration.classList.add('visible');
      spawnConfetti();
      return;
    }

    // Normal
    grid.style.display = '';
    document.getElementById('celebrationContainer').classList.remove('visible');

    if (activeItems.length === 0) {
      grid.innerHTML = '<div class="warenkorb-empty">Noch keine Produkte ausgewählt</div>';
    } else {
      grid.innerHTML = activeItems.map(function(item) {
        return '<div class="warenkorb-tile" onclick="checkOffItem(\'' + item.id + '\')" data-id="' + item.id + '">' +
          '<span class="tile-qty">x' + formatQty(item) + '</span>' +
          '<span class="tile-emoji">' + item.emoji + '</span>' +
          '<span class="tile-name">' + item.name + '</span>' +
        '</div>';
      }).join('');
    }
  }

  // ===== Erledigt Section =====
  function renderErledigtSection() {
    const erledigtItems = loadErledigt();
    const section = document.getElementById('erledigtSection');
    const toggle = document.getElementById('erledigtToggle');
    const grid = document.getElementById('erledigtGrid');
    const badge = document.getElementById('erledigtCountBadge');

    if (erledigtItems.length === 0) {
      section.style.display = 'none';
      return;
    }

    section.style.display = '';
    badge.textContent = erledigtItems.length;

    if (erledigtExpanded) {
      toggle.classList.add('expanded');
      grid.classList.add('expanded');
    } else {
      toggle.classList.remove('expanded');
      grid.classList.remove('expanded');
    }

    grid.innerHTML = erledigtItems.map(function(item) {
      return '<div class="erledigt-tile" onclick="restoreItem(\'' + item.id + '\')" data-id="' + item.id + '">' +
        '<span class="tile-qty">x' + formatQty(item) + '</span>' +
        '<span class="tile-emoji">' + item.emoji + '</span>' +
        '<span class="tile-name">' + item.name + '</span>' +
      '</div>';
    }).join('');
  }

  // ===== Check Off =====
  function checkOffItem(itemId) {
    const items = loadItems();
    const idx = items.findIndex(function(i) { return i.id === itemId; });
    if (idx === -1) return;

    const item = items[idx];
    const tileEl = document.querySelector('.warenkorb-tile[data-id="' + itemId + '"]');
    if (tileEl) tileEl.classList.add('checking');

    if (navigator.vibrate) navigator.vibrate(15);

    setTimeout(function() {
      items.splice(idx, 1);
      saveItems(items);

      const erledigt = loadErledigt();
      erledigt.unshift(item);
      saveErledigt(erledigt);

      updateProgress();
      renderActiveGrid();
      renderErledigtSection();
      updateCategoryBadges();

      // Auto-expand on first check
      if (erledigt.length === 1 && !erledigtExpanded) {
        erledigtExpanded = true;
        renderErledigtSection();
      }

      // Animate incoming erledigt tile
      const erledigtTile = document.querySelector('.erledigt-tile[data-id="' + itemId + '"]');
      if (erledigtTile) {
        erledigtTile.classList.add('incoming');
        setTimeout(function() { erledigtTile.classList.remove('incoming'); }, 400);
      }
    }, 350);
  }

  // ===== Restore =====
  function restoreItem(itemId) {
    const erledigt = loadErledigt();
    const idx = erledigt.findIndex(function(i) { return i.id === itemId; });
    if (idx === -1) return;

    const item = erledigt[idx];
    erledigt.splice(idx, 1);
    saveErledigt(erledigt);

    const items = loadItems();
    items.push(item);
    saveItems(items);

    if (navigator.vibrate) navigator.vibrate(10);

    updateProgress();
    renderActiveGrid();
    renderErledigtSection();
    updateCategoryBadges();

    const restoredTile = document.querySelector('.warenkorb-tile[data-id="' + itemId + '"]');
    if (restoredTile) {
      restoredTile.classList.add('restoring');
      setTimeout(function() { restoredTile.classList.remove('restoring'); }, 350);
    }
  }

  // ===== Reset =====
  function resetList() {
    saveItems([]);
    saveErledigt([]);
    erledigtExpanded = false;

    updateProgress();
    renderActiveGrid();
    renderErledigtSection();
    updateCategoryBadges();
  }

  // ===== Confetti =====
  function spawnConfetti() {
    const container = document.getElementById('confettiContainer');
    container.innerHTML = '';
    const colors = ['#4E9DA6', '#E8923A', '#6BBF6B', '#E07B7B', '#A07BCC', '#E8C44A', '#5BA8D5'];
    for (let i = 0; i < 40; i++) {
      const c = document.createElement('div');
      c.className = 'confetti';
      c.style.left = Math.random() * 100 + '%';
      c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      c.style.animationDuration = (1.5 + Math.random() * 1.5) + 's';
      c.style.animationDelay = (Math.random() * 0.5) + 's';
      c.style.width = (5 + Math.random() * 6) + 'px';
      c.style.height = (5 + Math.random() * 6) + 'px';
      c.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
      container.appendChild(c);
    }
    setTimeout(function() { container.innerHTML = ''; }, 3500);
  }

  // ===== Category Badges =====
  function updateCategoryBadges() {
    const items = loadItems();
    const erledigt = loadErledigt();
    const allItems = items.concat(erledigt);

    CATEGORIES.forEach(function(cat) {
      const catItems = allItems.filter(function(item) { return item.cat === cat.id; });
      const badge = document.querySelector('[data-cat-badge="' + cat.id + '"]');
      if (badge) {
        if (catItems.length > 0) {
          badge.textContent = catItems.length + ' gewählt';
          badge.classList.add('visible');
        } else {
          badge.classList.remove('visible');
        }
      }
    });
  }

  // ===== Categories =====
  function renderCategories() {
    const items = loadItems();
    const erledigt = loadErledigt();
    const allItems = items.concat(erledigt);
    const listEl = document.getElementById('categoryList');

    listEl.innerHTML = CATEGORIES.map(function(cat) {
      const catItems = allItems.filter(function(item) { return item.cat === cat.id; });
      const badgeClass = catItems.length > 0 ? 'category-badge visible' : 'category-badge';
      const badgeText = catItems.length > 0 ? catItems.length + ' gewählt' : '';

      return '<a class="category-card" href="kategorie.html?liste=' + LIST_ID + '&cat=' + cat.id + '" data-cat="' + cat.id + '">' +
        '<div class="category-icon ' + cat.color + '">' + cat.emoji + '</div>' +
        '<div class="category-info">' +
          '<div class="category-name">' + cat.name + '</div>' +
          '<div class="category-count">' + cat.totalProducts + ' Produkte</div>' +
        '</div>' +
        '<div class="category-right">' +
          '<span class="' + badgeClass + '" data-cat-badge="' + cat.id + '">' + badgeText + '</span>' +
          '<div class="category-chevron">' +
            '<svg viewBox="0 0 14 14" fill="none" stroke="' + CHEVRON_COLORS[cat.color] + '" stroke-width="2" stroke-linecap="round"><path d="M5 2l5 5-5 5"/></svg>' +
          '</div>' +
        '</div>' +
      '</a>';
    }).join('');
  }

  // ===== Erledigt Toggle =====
  document.getElementById('erledigtToggle').addEventListener('click', function() {
    erledigtExpanded = !erledigtExpanded;
    renderErledigtSection();
  });

  // ===== Init =====
  applyTheme(getTheme());
  renderCategories();
  updateProgress();
  renderActiveGrid();
  renderErledigtSection();

  // Re-render when returning from category page
  window.addEventListener('focus', function() {
    renderCategories();
    updateProgress();
    renderActiveGrid();
    renderErledigtSection();
  });
  window.addEventListener('pageshow', function() {
    renderCategories();
    updateProgress();
    renderActiveGrid();
    renderErledigtSection();
  });
</script>

</body>
</html>
