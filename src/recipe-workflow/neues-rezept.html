<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Neues Rezept ¬∑ ShopZebra</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
      background: var(--body-bg);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      transition: background 0.4s ease;
    }

    [data-theme="dark"] {
      --body-bg: #0a0a0e;
      --screen-bg: #121216;
      --screen-gradient: none;
      --surface: rgba(255,255,255,0.04);
      --surface-hover: rgba(255,255,255,0.06);
      --surface-border: rgba(255,255,255,0.06);
      --teal: #4E9DA6;
      --orange: #E8923A;
      --text-primary: #ffffff;
      --text-secondary: rgba(255,255,255,0.5);
      --text-dim: rgba(255,255,255,0.35);
      --card-bg: rgba(255,255,255,0.03);
      --card-border: rgba(255,255,255,0.06);
      --card-blur: 0px;
      --input-bg: rgba(255,255,255,0.04);
      --input-border: rgba(255,255,255,0.08);
      --input-focus: rgba(78,157,166,0.3);
      --frame-shadow: 0 0 60px rgba(0,0,0,0.5), 0 0 120px rgba(78,157,166,0.05);
      --frame-border: 1px solid rgba(255,255,255,0.08);
      --icon-radius: 50%;
      --cat-card-before-opacity: 0;
      --sheet-bg: #1a1a20;
    }

    [data-theme="glass"] {
      --body-bg: #1a1a2e;
      --screen-bg: #0a0a12;
      --screen-gradient:
        radial-gradient(ellipse at 20% 80%, rgba(120, 50, 180, 0.35) 0%, transparent 60%),
        radial-gradient(ellipse at 80% 20%, rgba(50, 120, 180, 0.3) 0%, transparent 60%),
        radial-gradient(ellipse at 50% 50%, rgba(180, 50, 120, 0.2) 0%, transparent 60%);
      --surface: rgba(255,255,255,0.06);
      --surface-hover: rgba(255,255,255,0.09);
      --surface-border: rgba(255,255,255,0.1);
      --teal: #4E9DA6;
      --orange: #E8923A;
      --text-primary: #ffffff;
      --text-secondary: rgba(255,255,255,0.5);
      --text-dim: rgba(255,255,255,0.35);
      --card-bg: rgba(255,255,255,0.06);
      --card-border: rgba(255,255,255,0.1);
      --card-blur: blur(20px);
      --input-bg: rgba(255,255,255,0.06);
      --input-border: rgba(255,255,255,0.1);
      --input-focus: rgba(78,157,166,0.4);
      --frame-shadow: 0 0 0 2px rgba(255,255,255,0.08), 0 40px 80px rgba(0,0,0,0.6), 0 0 120px rgba(139,92,246,0.15);
      --frame-border: none;
      --icon-radius: 14px;
      --cat-card-before-opacity: 1;
      --sheet-bg: rgba(20,20,35,0.95);
    }

    .phone-frame {
      width: 390px;
      height: 844px;
      background: var(--screen-bg);
      background-image: var(--screen-gradient);
      border-radius: 44px;
      box-shadow: var(--frame-shadow);
      border: var(--frame-border);
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
      transition: background 0.4s ease, background-color 0.4s ease, border-color 0.3s ease, box-shadow 0.4s ease;
    }

    .status-bar {
      height: 47px;
      padding: 0 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--screen-bg);
      backdrop-filter: var(--card-blur);
      transition: background 0.4s ease, background-color 0.4s ease;
    }

    .status-time {
      width: 54px;
    }

    .status-icons {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-icons svg {
      width: 16px;
      height: 16px;
      fill: var(--text-primary);
      opacity: 1;
    }

    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
    }

    .theme-toggle svg {
      width: 20px;
      height: 20px;
    }

    .nav-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 24px 16px;
    }

    .nav-back {
      display: flex;
      align-items: center;
      gap: 6px;
      background: none;
      border: none;
      color: var(--teal);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      text-decoration: none;
      transition: opacity 0.2s ease;
    }

    .nav-back:hover {
      opacity: 0.8;
    }

    .nav-back svg {
      width: 20px;
      height: 20px;
      fill: var(--teal);
    }

    .nav-title {
      font-size: 17px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .nav-spacer {
      width: 70px;
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: 0 24px 24px;
      scrollbar-width: none;
    }
    .content::-webkit-scrollbar { display: none; }

    .emoji-picker-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 24px;
    }

    .emoji-preview {
      width: 96px;
      height: 96px;
      background: var(--input-bg);
      border: 2px solid var(--input-border);
      border-radius: var(--icon-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      cursor: pointer;
      position: relative;
      transition: background 0.4s ease, border-color 0.3s ease, transform 0.2s ease;
    }

    .emoji-preview:hover {
      transform: scale(1.05);
    }

    .emoji-preview::after {
      content: '';
      position: absolute;
      bottom: -2px;
      right: -2px;
      width: 28px;
      height: 28px;
      background: var(--teal);
      border-radius: 50%;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>');
      background-size: 14px;
      background-position: center;
      background-repeat: no-repeat;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* ===== Bottom Sheet Overlay ===== */
    .sheet-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 90;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .sheet-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .bottom-sheet {
      position: absolute;
      left: 0; right: 0; bottom: 0;
      z-index: 100;
      background: var(--sheet-bg);
      border-radius: 28px 28px 0 0;
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-top: 1px solid var(--surface-border);
      transform: translateY(100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      max-height: 75%;
      display: flex;
      flex-direction: column;
    }
    .bottom-sheet.active { transform: translateY(0); }

    .sheet-handle {
      width: 36px; height: 4px; border-radius: 2px;
      background: rgba(255,255,255,0.2);
      margin: 10px auto 0; flex-shrink: 0;
    }
    .sheet-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 20px 12px; flex-shrink: 0;
    }
    .sheet-title { font-size: 18px; font-weight: 700; }
    .sheet-close {
      width: 32px; height: 32px; border-radius: 50%;
      background: var(--surface); border: 1px solid var(--surface-border);
      color: var(--text-secondary); font-size: 18px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    }

    .sheet-search { padding: 0 20px 12px; flex-shrink: 0; }
    .search-input {
      width: 100%; padding: 10px 14px 10px 38px; border-radius: 14px;
      background: var(--surface); border: 1px solid var(--surface-border);
      color: var(--text-primary); font-size: 14px; font-weight: 500;
      font-family: inherit; outline: none; transition: border-color 0.2s ease;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='rgba(255,255,255,0.3)'%3E%3Cpath d='M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E");
      background-size: 18px; background-repeat: no-repeat; background-position: 12px center;
    }
    .search-input::placeholder { color: var(--text-dim); }
    .search-input:focus { border-color: var(--teal); }

    .no-results {
      text-align: center; padding: 32px 20px; color: var(--text-dim);
      font-size: 14px; font-weight: 500; display: none;
    }

    .pill-tabs {
      display: flex; gap: 6px; padding: 0 20px 14px;
      overflow-x: auto; scrollbar-width: none; flex-shrink: 0;
    }
    .pill-tabs::-webkit-scrollbar { display: none; }
    .pill-tab {
      flex-shrink: 0; padding: 7px 14px; font-size: 12px; font-weight: 600;
      color: var(--text-dim); background: var(--surface);
      border: 1px solid var(--surface-border); border-radius: 20px;
      cursor: pointer; font-family: inherit; transition: all 0.2s ease; white-space: nowrap;
    }
    .pill-tab:hover { color: var(--text-secondary); background: var(--surface-hover); }
    .pill-tab.active { color: #fff; background: var(--teal); border-color: var(--teal); }

    .sheet-scroll {
      flex: 1; overflow-y: auto; padding: 0 20px 30px; scrollbar-width: none;
    }
    .sheet-scroll::-webkit-scrollbar { display: none; }
    .sheet-cat-label {
      font-size: 11px; font-weight: 600; color: var(--text-dim);
      text-transform: uppercase; letter-spacing: 1px;
      margin-bottom: 10px; margin-top: 16px;
    }
    .sheet-cat-label:first-child { margin-top: 0; }
    .sheet-grid {
      display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px;
    }
    .sheet-emoji {
      aspect-ratio: 1; border: 2px solid transparent; border-radius: 14px;
      background: transparent; font-size: 28px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.1s ease;
      padding: 0;
    }
    .sheet-emoji:hover { background: var(--surface-hover); transform: scale(1.12); }
    .sheet-emoji:active { transform: scale(0.92); }
    .sheet-emoji.selected {
      border-color: var(--teal);
      background: rgba(78,157,166,0.15);
      box-shadow: 0 0 12px rgba(78,157,166,0.2);
    }

    .form-section {
      margin-bottom: 24px;
    }

    .form-input {
      width: 100%;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 16px;
      padding: 16px 18px;
      font-size: 17px;
      font-weight: 600;
      color: var(--text-primary);
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.4s ease;
    }

    .form-input::placeholder {
      color: var(--text-dim);
      font-weight: 500;
    }

    .form-input:focus {
      border-color: var(--teal);
      box-shadow: 0 0 0 3px var(--input-focus);
    }

    .inline-meta {
      display: flex;
      gap: 12px;
      margin-bottom: 32px;
    }

    .inline-meta .meta-field {
      flex: 0 0 auto;
    }

    .inline-meta .meta-field:first-child {
      width: 80px;
    }

    .inline-meta .meta-field:last-child {
      width: 120px;
    }

    .zeit-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .zeit-wrapper input {
      width: 64px !important;
    }

    .zeit-suffix {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .meta-field label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-dim);
      margin-bottom: 8px;
    }

    .meta-field input {
      width: 100%;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.4s ease;
    }

    .meta-field input:focus {
      border-color: var(--teal);
      box-shadow: 0 0 0 3px var(--input-focus);
    }

    .form-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      display: block;
    }

    .ingredient-row, .step-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
    }

    .ingredient-row input {
      flex: 1;
    }

    .step-row {
      align-items: flex-start;
    }

    .step-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--teal);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      flex-shrink: 0;
      margin-top: 16px;
    }

    .step-row textarea {
      flex: 1;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 16px;
      padding: 16px 18px;
      font-size: 15px;
      font-weight: 500;
      color: var(--text-primary);
      font-family: inherit;
      outline: none;
      resize: none;
      min-height: 60px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.4s ease;
    }

    .step-row textarea::placeholder {
      color: var(--text-dim);
    }

    .step-row textarea:focus {
      border-color: var(--teal);
      box-shadow: 0 0 0 3px var(--input-focus);
    }

    .remove-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.05);
      border: none;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .remove-btn:hover {
      background: rgba(255,100,100,0.15);
      color: #ff6b6b;
    }

    .add-btn {
      width: 100%;
      background: transparent;
      border: 2px dashed var(--teal);
      border-radius: 16px;
      padding: 14px;
      color: var(--teal);
      font-size: 15px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 8px;
      transition: background 0.2s ease, border-color 0.2s ease;
    }

    .add-btn:hover {
      background: rgba(78,157,166,0.08);
    }

    .cta-button {
      width: 100%;
      background: linear-gradient(135deg, var(--teal), #3A8A92);
      border: none;
      border-radius: 20px;
      padding: 18px;
      color: white;
      font-size: 16px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(78,157,166,0.3);
      margin-top: 32px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(78,157,166,0.4);
    }

    .cta-button:active {
      transform: translateY(0);
    }

    /* Auto-grow textarea */
    .step-row textarea {
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div class="phone-frame">
    <div class="status-bar">
      <div class="status-time">9:41</div>
      <div class="status-icons">
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle theme"></button>
        <svg viewBox="0 0 16 16"><path d="M1.5 4.5C4 2 7.5 1 8 1s4 1 6.5 3.5l-1.2 1.2C11.2 3.6 9 2.5 8 2.5S4.8 3.6 2.7 5.7L1.5 4.5zM4 7.3C5.3 6 6.8 5.2 8 5.2s2.7.8 4 2.1L10.8 8.5C9.8 7.5 9 7 8 7s-1.8.5-2.8 1.5L4 7.3zM6.5 10c.8-.8 1.2-1 1.5-1s.7.2 1.5 1L8 11.5 6.5 10z"/></svg>
        <svg viewBox="0 0 16 16"><path d="M1 4h2v8H1V4zm3.5 2h2v6h-2V6zM8 3h2v9H8V3zm3.5 1h2v8h-2V4z"/></svg>
        <svg viewBox="0 0 24 14"><rect x="0.5" y="0.5" width="20" height="13" rx="2.5" stroke="white" stroke-opacity="0.35" fill="none"/><path opacity="0.4" d="M22 5v4a2 2 0 000-4z" fill="white"/><rect x="2" y="2" width="15" height="9" rx="1.5" fill="white"/></svg>
      </div>
    </div>

    <div class="nav-header">
      <a href="rezepte.html" class="nav-back">
        <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        Rezepte
      </a>
      <div class="nav-title">Neues Rezept</div>
      <div class="nav-spacer"></div>
    </div>

    <div class="content">
      <div class="emoji-picker-wrapper">
        <div class="emoji-preview" id="emojiPreview" onclick="openSheet()">üçù</div>
      </div>

      <div class="form-section">
        <input type="text" class="form-input" id="recipeName" placeholder="Rezeptname">
      </div>

      <div class="inline-meta">
        <div class="meta-field">
          <label>Portionen</label>
          <input type="number" id="portionen" value="4" min="1">
        </div>
        <div class="meta-field">
          <label>Zeit</label>
          <div class="zeit-wrapper">
            <input type="number" id="zeit" placeholder="30" min="1">
            <span class="zeit-suffix">Min</span>
          </div>
        </div>
      </div>

      <div class="form-section">
        <label class="form-label">ZUTATEN</label>
        <div id="ingredientsContainer">
          <div class="ingredient-row">
            <input type="text" class="form-input" placeholder="z.B. 500g Spaghetti">
            <button class="remove-btn" onclick="removeIngredient(this)">√ó</button>
          </div>
          <div class="ingredient-row">
            <input type="text" class="form-input" placeholder="z.B. 500g Spaghetti">
            <button class="remove-btn" onclick="removeIngredient(this)">√ó</button>
          </div>
          <div class="ingredient-row">
            <input type="text" class="form-input" placeholder="z.B. 500g Spaghetti">
            <button class="remove-btn" onclick="removeIngredient(this)">√ó</button>
          </div>
        </div>
        <button class="add-btn" onclick="addIngredient()">
          <span>Ôºã</span> Zutat
        </button>
      </div>

      <div class="form-section">
        <label class="form-label">ZUBEREITUNG</label>
        <div id="stepsContainer">
          <div class="step-row">
            <div class="step-number">1</div>
            <textarea placeholder="Schritt beschreiben..." oninput="autoGrow(this)"></textarea>
          </div>
          <div class="step-row">
            <div class="step-number">2</div>
            <textarea placeholder="Schritt beschreiben..." oninput="autoGrow(this)"></textarea>
          </div>
        </div>
        <button class="add-btn" onclick="addStep()">
          <span>Ôºã</span> Schritt
        </button>
      </div>

      <button class="cta-button" onclick="saveRecipe()">Rezept speichern</button>
    </div>

    <!-- Emoji Picker Overlay -->
    <div class="sheet-overlay" id="sheetOverlay" onclick="closeSheet()"></div>

    <!-- Emoji Picker Bottom Sheet -->
    <div class="bottom-sheet" id="bottomSheet">
      <div class="sheet-handle"></div>
      <div class="sheet-header">
        <span class="sheet-title">Icon w√§hlen</span>
        <button class="sheet-close" onclick="closeSheet()">‚úï</button>
      </div>
      <div class="sheet-search">
        <input class="search-input" id="searchInput" type="text" placeholder="Suchen‚Ä¶ z.B. Pizza, Curry" oninput="filterEmojis()">
      </div>
      <div class="pill-tabs" id="pillTabs"></div>
      <div class="sheet-scroll" id="sheetScroll"></div>
      <div class="no-results" id="noResults">Kein passendes Icon gefunden</div>
    </div>
  </div>

  <script>
    var MOON_SVG = '<svg viewBox="0 0 24 24" fill="white"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>';
    var SUN_SVG = '<svg viewBox="0 0 24 24" fill="white"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>';

    function getTheme() {
      return localStorage.getItem('shopzebra_theme') || 'dark';
    }

    function applyTheme(t) {
      document.documentElement.setAttribute('data-theme', t);
      localStorage.setItem('shopzebra_theme', t);
      document.getElementById('themeToggle').innerHTML = t === 'dark' ? MOON_SVG : SUN_SVG;
    }

    function toggleTheme() {
      applyTheme(getTheme() === 'dark' ? 'glass' : 'dark');
    }

    applyTheme(getTheme());

    // Emoji picker (Bottom Sheet with Search)
    let selectedEmoji = 'üçù';

    var EMOJI_CATEGORIES = {
      'Gerichte': [
        {e:'üçù',k:'pasta spaghetti nudeln'},{e:'üçõ',k:'curry reis'},{e:'üç≤',k:'eintopf suppe topf'},
        {e:'ü•ò',k:'pfanne schmortopf paella'},{e:'üçú',k:'ramen nudelsuppe asiatisch'},{e:'ü´ï',k:'fondue k√§se'},
        {e:'ü•£',k:'m√ºsli bowl sch√ºssel porridge'},{e:'üç±',k:'bento japanisch'},{e:'üçö',k:'reis schale'},
        {e:'üçô',k:'onigiri reisb√§llchen'},{e:'üçò',k:'reiskuchen'}
      ],
      'Fast Food': [
        {e:'üçï',k:'pizza'},{e:'üçî',k:'burger hamburger'},{e:'üå≠',k:'hotdog w√ºrstchen'},
        {e:'üçü',k:'pommes frites'},{e:'ü•™',k:'sandwich brot'},{e:'üåÆ',k:'taco mexikanisch'},
        {e:'üåØ',k:'burrito wrap'},{e:'ü•ô',k:'pita d√∂ner kebab falafel'},{e:'üßÜ',k:'falafel b√§llchen'},
        {e:'ü•ü',k:'dumpling maultasche'},{e:'ü•†',k:'gl√ºckskeks'}
      ],
      'Fleisch & Fisch': [
        {e:'üçó',k:'h√§hnchen huhn keule'},{e:'üçñ',k:'fleisch knochen rippe'},{e:'ü•©',k:'steak rind fleisch'},
        {e:'ü•ì',k:'speck bacon'},{e:'üç£',k:'sushi lachs fisch'},{e:'üç§',k:'garnele shrimp'},
        {e:'üêü',k:'fisch lachs forelle'},{e:'üç≥',k:'ei spiegelei bratei'},{e:'ü•ö',k:'ei'}
      ],
      'Obst': [
        {e:'üçé',k:'apfel rot'},{e:'üçê',k:'birne'},{e:'üçä',k:'orange mandarine'},{e:'üçã',k:'zitrone'},
        {e:'üçå',k:'banane'},{e:'üçâ',k:'wassermelone melone'},{e:'üçá',k:'trauben weintrauben'},
        {e:'üçì',k:'erdbeere'},{e:'ü´ê',k:'blaubeere heidelbeere'},{e:'üçí',k:'kirsche'},
        {e:'üçë',k:'pfirsich'},{e:'ü•≠',k:'mango'},{e:'üçç',k:'ananas'},{e:'ü•ù',k:'kiwi'},{e:'ü••',k:'kokosnuss kokos'}
      ],
      'Gem√ºse': [
        {e:'ü•ï',k:'m√∂hre karotte'},{e:'üåΩ',k:'mais'},{e:'ü•¶',k:'brokkoli'},{e:'ü•¨',k:'salat blattgem√ºse'},
        {e:'ü•í',k:'gurke'},{e:'üçÜ',k:'aubergine'},{e:'ü´ë',k:'paprika'},{e:'üå∂Ô∏è',k:'chili scharf'},
        {e:'üçÖ',k:'tomate'},{e:'ü•ë',k:'avocado'},{e:'üßÑ',k:'knoblauch'},{e:'üßÖ',k:'zwiebel'},
        {e:'üçÑ',k:'pilz champignon'},{e:'ü•î',k:'kartoffel'}
      ],
      'Brot & Geb√§ck': [
        {e:'üçû',k:'brot toast'},{e:'ü•ê',k:'croissant'},{e:'ü•ñ',k:'baguette'},{e:'ü•®',k:'brezel'},
        {e:'ü•Ø',k:'bagel'},{e:'üßá',k:'waffel'},{e:'ü•û',k:'pancake pfannkuchen'},{e:'üßÄ',k:'k√§se'}
      ],
      'S√º√ües': [
        {e:'üßÅ',k:'cupcake muffin'},{e:'üç∞',k:'kuchen torte'},{e:'üéÇ',k:'geburtstagskuchen torte'},
        {e:'ü•ß',k:'pie kuchen'},{e:'üç©',k:'donut'},{e:'üç™',k:'keks cookie'},{e:'üç´',k:'schokolade'},
        {e:'üç¨',k:'bonbon'},{e:'üç≠',k:'lolli lollipop'},{e:'üçÆ',k:'pudding'},{e:'üçØ',k:'honig'},
        {e:'üç¶',k:'eis eiscreme'},{e:'üç®',k:'eis becher'}
      ],
      'Getr√§nke': [
        {e:'‚òï',k:'kaffee'},{e:'üçµ',k:'tee'},{e:'ü•õ',k:'milch'},{e:'üßã',k:'bubble tea boba'},
        {e:'ü•§',k:'limo softdrink'},{e:'üç∫',k:'bier'},{e:'üç∑',k:'wein rotwein'},{e:'üßÉ',k:'saft'}
      ],
    };

    var activeCategory = 'Gerichte';

    function buildSheet() {
      var catNames = Object.keys(EMOJI_CATEGORIES);
      var pillsHtml = '';
      for (var c = 0; c < catNames.length; c++) {
        var cat = catNames[c];
        var active = cat === activeCategory ? ' active' : '';
        pillsHtml += '<button class="pill-tab' + active + '" data-cat="' + cat + '" onclick="filterCategory(\'' + cat + '\')">' + cat + '</button>';
      }
      document.getElementById('pillTabs').innerHTML = pillsHtml;
      renderSheetGrid('');
    }

    function renderSheetGrid(query) {
      var catNames = Object.keys(EMOJI_CATEGORIES);
      var html = '';
      var totalMatches = 0;
      query = (query || '').toLowerCase().trim();

      for (var c = 0; c < catNames.length; c++) {
        var cat = catNames[c];
        var items = EMOJI_CATEGORIES[cat];
        var matched = [];
        for (var i = 0; i < items.length; i++) {
          if (!query || items[i].k.indexOf(query) !== -1 || cat.toLowerCase().indexOf(query) !== -1) {
            matched.push(items[i]);
          }
        }
        if (matched.length === 0) continue;
        totalMatches += matched.length;

        html += '<div class="sheet-cat-label" id="sheet-cat-' + c + '">' + cat + '</div>';
        html += '<div class="sheet-grid">';
        for (var j = 0; j < matched.length; j++) {
          var sel = matched[j].e === selectedEmoji ? ' selected' : '';
          html += '<button class="sheet-emoji' + sel + '" onclick="pickEmoji(this, \'' + matched[j].e + '\')">' + matched[j].e + '</button>';
        }
        html += '</div>';
      }

      document.getElementById('sheetScroll').innerHTML = html;
      document.getElementById('noResults').style.display = totalMatches === 0 ? 'block' : 'none';
      document.getElementById('pillTabs').style.display = query ? 'none' : 'flex';
    }

    function filterEmojis() {
      renderSheetGrid(document.getElementById('searchInput').value);
    }

    function filterCategory(cat) {
      activeCategory = cat;
      var pills = document.querySelectorAll('.pill-tab');
      for (var i = 0; i < pills.length; i++) {
        pills[i].classList.toggle('active', pills[i].getAttribute('data-cat') === cat);
      }
      var catNames = Object.keys(EMOJI_CATEGORIES);
      var idx = catNames.indexOf(cat);
      var el = document.getElementById('sheet-cat-' + idx);
      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function openSheet() {
      document.getElementById('searchInput').value = '';
      buildSheet();
      document.getElementById('bottomSheet').classList.add('active');
      document.getElementById('sheetOverlay').classList.add('active');
      setTimeout(function() { document.getElementById('searchInput').focus(); }, 350);
    }

    function closeSheet() {
      document.getElementById('bottomSheet').classList.remove('active');
      document.getElementById('sheetOverlay').classList.remove('active');
    }

    function pickEmoji(btn, emoji) {
      selectedEmoji = emoji;
      document.getElementById('emojiPreview').textContent = emoji;
      var allBtns = document.querySelectorAll('.sheet-emoji');
      for (var i = 0; i < allBtns.length; i++) allBtns[i].classList.remove('selected');
      btn.classList.add('selected');
      setTimeout(closeSheet, 250);
    }

    // Ingredients
    function addIngredient() {
      const container = document.getElementById('ingredientsContainer');
      const row = document.createElement('div');
      row.className = 'ingredient-row';
      row.innerHTML = `
        <input type="text" class="form-input" placeholder="z.B. 500g Spaghetti">
        <button class="remove-btn" onclick="removeIngredient(this)">√ó</button>
      `;
      container.appendChild(row);
    }

    function removeIngredient(btn) {
      const container = document.getElementById('ingredientsContainer');
      if (container.children.length > 1) {
        btn.parentElement.remove();
      }
    }

    // Steps
    function addStep() {
      const container = document.getElementById('stepsContainer');
      const stepNum = container.children.length + 1;
      const row = document.createElement('div');
      row.className = 'step-row';
      row.innerHTML = `
        <div class="step-number">${stepNum}</div>
        <textarea placeholder="Schritt beschreiben..." oninput="autoGrow(this)"></textarea>
      `;
      container.appendChild(row);
    }

    function updateStepNumbers() {
      const container = document.getElementById('stepsContainer');
      Array.from(container.children).forEach((row, idx) => {
        row.querySelector('.step-number').textContent = idx + 1;
      });
    }

    function autoGrow(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = textarea.scrollHeight + 'px';
    }

    // Parse ingredient line
    function parseIngredient(line) {
      line = line.trim();
      if (!line) return null;

      // Regex to match quantity and unit at the beginning
      // Supports: "500g", "2 EL", "1.5 kg", "3 St", "400 ml", etc.
      const match = line.match(/^(\d+(?:[.,]\d+)?)\s*(g|kg|ml|l|el|tl|st|st√ºck|dose|dosen|bund|prise)?\.?\s*/i);

      if (match) {
        const qty = parseFloat(match[1].replace(',', '.'));
        const unit = match[2] ? match[2].toLowerCase() : '';
        const name = line.substring(match[0].length).trim();
        return { qty, unit, name };
      }

      // No quantity found, treat as name only
      return { qty: 0, unit: '', name: line };
    }

    // Save recipe
    function saveRecipe() {
      const recipeName = document.getElementById('recipeName').value.trim();
      const portionen = parseInt(document.getElementById('portionen').value) || 4;
      const zeitVal = document.getElementById('zeit').value.trim();
      const zeit = zeitVal ? zeitVal + ' Min' : '';

      if (!recipeName) {
        alert('Bitte gib einen Rezeptnamen ein.');
        document.getElementById('recipeName').focus();
        return;
      }

      // Collect ingredients
      const ingredientInputs = document.querySelectorAll('#ingredientsContainer input');
      const ingredients = [];
      let hasIngredient = false;

      ingredientInputs.forEach(input => {
        const parsed = parseIngredient(input.value);
        if (parsed && parsed.name) {
          ingredients.push(parsed);
          hasIngredient = true;
        }
      });

      if (!hasIngredient) {
        alert('Bitte gib mindestens eine Zutat ein.');
        return;
      }

      // Collect steps
      const stepTextareas = document.querySelectorAll('#stepsContainer textarea');
      const steps = [];
      stepTextareas.forEach(textarea => {
        const text = textarea.value.trim();
        if (text) {
          steps.push(text);
        }
      });

      // Create recipe object
      const recipe = {
        id: 'recipe_' + Date.now(),
        name: recipeName,
        emoji: selectedEmoji,
        color: 'green',
        portionen: portionen,
        zeit: zeit,
        ingredients: ingredients,
        steps: steps
      };

      // Save to localStorage
      const existingRecipes = JSON.parse(localStorage.getItem('shopzebra_rezepte') || '[]');
      existingRecipes.push(recipe);
      localStorage.setItem('shopzebra_rezepte', JSON.stringify(existingRecipes));

      // Redirect
      window.location.href = 'rezepte.html';
    }
  </script>
</body>
</html>
